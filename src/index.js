// utils 

function query(queryString) {
  return document.querySelector(queryString)
}

const IMAGE_MAP = {

}

function loader(image, callback) {
  if(IMAGE_MAP[image]) return callback(IMAGE_MAP[image])
  const dom = new Image() 
  dom.src = image 
  dom.width = 10 
  dom.height = 10
  dom.style.display = 'block'
  dom.onload = () => {
    IMAGE_MAP[image] = dom 
    callback(dom)
  }
}

// 保留4位小数
function toFixed4(number) {
  return parseFloat(number.toFixed(4))
}

function getWidth(target) {
  return target.width || 1
}
function getHeight(target) {
  return target.height || 1
}

// 碰撞检测
function knockJudge(origin, target, coincide) {
  if(!!coincide) return origin.x === target.x && origin.y === target.y
  return origin.x < target.x + getWidth(target) && origin.x + getWidth(origin) > target.x && origin.y < target.y + getHeight(target) && origin.y + getHeight(origin) > target.y 
}

// 碰撞障碍墙检测
function knockWall(position) {
  const { x, y } = position
  const isOuter = x < 1 || x > 31 || y < 1 || y > 11
  if(isOuter) return true  
  if(x % 1 !== 0 || y % 1 !== 0) {
    const maxX = Math.ceil(x)
    const minX = Math.floor(x)
    const maxY = Math.ceil(y)
    const minY = Math.floor(y)
    return [{ x: minX, y: minY }, { x: minX, y: maxY }, { x: maxX, y: minY }, { x: maxX, y: maxY }].some(knockWall)
  }
  return x % 2 === 0 && y % 2 === 0
}

// Function

function stopGame() {
	isStart = !isStart
	StopButton.innerHTML = isStart ? "⏺ " : "⏩"
	startPrompt && startPrompt()
	if (!isStart) {
		startPrompt = createGamePrompt({
			content: "游戏暂停(*^▽^*)",
			timeout: -1,
			onRestart: () => {
				startPrompt && startPrompt()
				isStart = true
				EventEmitter.emit(EMITTER_START_OP)
			},
		})
	}
	EventEmitter.emit(EMITTER_START_OP)
}
function getInfo(target) {
	return {
		x: target.x(),
		y: target.y(),
		width: target.width(),
		height: target.height(),
	}
}

function formatInfo(target) {
	const parse = (value) => Math.round(value / UNIT)
	return {
		x: parse(target.x),
		y: parse(target.y),
		width: parse(target.width),
		height: parse(target.height)
	}
}

// type
// LoopBuff TimeBoomBuff SuperBoomBuff
function getBuff(type) {
	switch (type) {
		case "LoopBuff":
			return LoopBuff
		case "TimeBoomBuff":
			return TimeBoomBuff
		case "SuperBoomBuff":
			return SuperBoomBuff
	}
}

// type
// BalloonMonster CrossWallMonster SpeedMonster
function getMonster(type) {
	switch (type) {
		case "BalloonMonster":
			return BalloonMonster
		case "CrossWallMonster":
			return CrossWallMonster
		case "SpeedMonster":
			return SpeedMonster
	}
}

function randomMonster() {
	return getMonster(['BalloonMonster', 'CrossWallMonster', 'SpeedMonster'][Math.floor(Math.random() * 3)])
}

// Constants

const BOOM = "data:image/png;base64,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"
const BALLOON_MONSTER = "data:image/png;base64,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"
const BALLOON_MONSTER_DIE = "data:image/png;base64,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"
const CROSS_MONSTER = "data:image/png;base64,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"
const CROSS_MONSTER_DIE = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAMAAADX9CSSAAAC/VBMVEUAAAAjPSMhTx5RijlGc0cpUidLY1EwVD9ecZIbNzhghKUeR00jTTs5W2ZhgoE4X2k2XmNKZGtLZHI3YUsVPiIcPx1MgzF5msJLcI6NrcpYhKVni6UtVzmVsMJfcYFae4pkgnghSVc7ZndHbnVOdG8ON0UwYU5FXGQgTCFigIVhj60nTV4VP0IcSh88W1YTPURSZ3BYd2sKJyxfhoM/alQ4VEE4aT5QaFpsoep1oudvn+MAAQBnl9u62Px4pu+px+Z3o99ynN9tnN9TeKvP7f3I3fmArO50oe5vpOt0n+pzpehznedvoOWHq+NhjsxUgchGbJgCEDDH3/2+3/2gxvq30Phwovhyp/N1o/OVuu9yoe+Lt+2OsutsnemAquZ8puZ4oOR4puN1nuCktdZzmdJ8ndF9pNBmjL5Pfb1McJlEbIIfQ1oZOEQKJDsIICwABA8ACQr6///t///n/P/k8v3e8v3R6P3I6P3F4f3F3v3o7fy/2fzO5Pumy/uz1vmIsfmawffT3vbb4fWOuPO/1/JtpPGdwvCkxu9wnu2xx+uFq+t9puuSuembvueWs+NrnOG/y+Cevt+OtN5vm9uXsdSFqNNgjNGNqtBrkc52nMlwlcFihbVmja9tk6pOdKJYfZs3YZA0VYIzW3wkQ3ItT28lTWM5YWE5QU8ZP04oQ0gRNEEBDCQAAArW9/3V5/224P2wzPuvz/dznvTO2vG2yvDU4++z0+uEtet5purb6+m5yunM3+ejwefG2eLH2eGFsuClwN2Dpt1/nt23xNyPq9yBpNpsndigttdrkdNXidOluM5wk82RsMlrk8muvshvlsZnisWhrcBId8BXgLytq7pkjrVQfbRpkLNigq2RlaFDap9qiJ46a56Kiphne5gwXpiMmZV7iZVlh5RBY415e4pJcYlAWolGXYYiUYQ+aINdhII2UoAnUHo3U3ZQcXVCW3BjcW9OXWsbOGYhOWI7Vl5TYFxITlsgO1sIJVItWEsJGz4SKzEKGywGGCQAAhcbAJfZAAAAOHRSTlMACBgPNC4pI/v29fPU0rqpi4lyWUg6F/7++/r29PDs6ujl5ODX18/LysXDvLOzrqSfn5iWjol8bN/sHpwAAAIzSURBVCjPASgC1/0AABYEFBUCAwMEBQIBAAAAABYAAQIBAAAAAzb5pqYcKC0MDQ8QEwEABQwQDuo0AQAAEwuiZ8/lqKqlm5jN1SIvJaKafYedJgIAFFCWiLI8T2hPPI86j05oaJZJf39BCg8AMkNKVlZYOUE6OjhMOkFBYktHWD5gZh8ACWk8hVY+ilmAg0ZAXlxcXIs+PotNFxIANaXcPEqMPUVSU4aVflJFUlS4OVk/KQIABqroPECRfM7KdrGXfJDRrn5GOVSEMQEAN6jfOkCRvfDxhFWUgdn2kD1GTFm2IBUAqeNPWl8/vvWnulVjgd2nwz1GTF+MnScAbUNdWF8/u+DhRbRjgtTksz1eOkJhZggAbUNaWmA/dbm1dIljenqCdHtNXjk5wggAbp5KSDqNrXJzc4nHdXFxcnmOfVSKZd4ACelOSEhbr3d3eLyUPUREdrCOeFPBChIABwugQldKt5KSlZmZZr9bW03Ee3mXDQEAACzsPFc4YWWb5uuhoUOTQmLFjVXALgEABCGgk4hdQWfn+lFRUaPTODlAZYdFDgUAbFBOS0dJmO38cDs7b1GjyUhMZIZEHREAbZ5iSUdL0PesOzs7rP740l04QoBEPx4AbFDIS0c5y6T9cDs7b6vyT1eFOINTzDAABivaQklgZNjvbnBvq/NDTj44OE0ZJAcAAAYYZEBnaZzb9Ptua2maUNbGYdcRAgAAAAMzG5xqa2ri7qlsap+fa6QaKiMHAAASXtJWmYvaKQAAAABJRU5ErkJggg=="
const SPEED_MONSTER = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAC+lBMVEUAAAAHEwALHAIKFQANHgAHGAASIQAeYBsPIwCGIkkcCgUaWxOYKE12LkZKAh0FLAIKRgwMJQAFLAISTQ0STQ6xG1CWK0UyDxcyCwsENwYDIQAUThBtJEBiKD4nCAOBLk5WMzE3HxgRFwcIMAYELAMlAwAwBAYGLQMTIQAHOwAeUA2cPWNaDS4cFBOnK0gnAAwKEAAxAAFWERQYCQEvIA0iBQFPGxxJGRgjJAUEOQ8DIwAiCwURRBYGGgAjAgEfAgCeLFXPClUwAAQtAALMHGCzIljPGVZ0J0GFFj9oCCg+AQsnAQCuNGPDIFzLDVfbC0+MHUeSCDg2AAT93/DTFl/lB1+gJ1bTFlTKDk7GB06/BEl7IkOIBTuJBjJkBB5QAQ8pAQn/5vrmCmK5GWCuJl/fBl6lKF3ZHV3IC13WClyYMVjBCVWLMlKpIFCjHlCoBD9wBS1JCCJqARoyEAtHAAoNAgECEgDKKWrnEWfDKWXSI2LYEWLIGF7QD17ZBV24I1ugLlqYK1rYCFijJVXWElW5ElXIC1S7DE/EH02zGUe3BUfCE0azAkN7Fzt9CzSEBDSaAjN0ETF+Ay5UFyw8FCVyAB9dABdZARVVARUxAg8TCgEAAAD87/z/yenVuMrWdJXHZ4jCUH3bKGvaG2S1JWPkG2OPPGCiNV+9FlrdElm9KlezK1bjDVTVBlTdFlPFFlG3EkqxCUp9KDx3IjyKEztvKjNsEC9ICyxaCSFUDiBPBhkuABk2ABM/DhJIABESFwL/z/H8web8udfaytbupcbHsrjcZJfTU4fAXH7CP3WoRnHxGnC7NmudRGmnMmDrF1zKF1rjB1KUJFCPK03QDU2pEEbGBkOeBUKEKD5mMz1nHTuYFTuSAy5IEy10DyeIACZEGCN7BiJaBBwsJBc8Bw0AMQABIgD/2O351OrvyuH/v+Hqucr3kML0lbe7prXolrWmh5zCXn+FZXq+U3OSWnLDSXHGOW59VWtXSVRxNEiZE0ZoJTMbAAxbAACwv4zsAAAAPnRSTlMAQWROJlwwCx7+/Rv+/v10Wko9IhP+/vrrmDYr/v7+/fv67ObOx6iDVEM2/f39+/r6+dvb2tLRy8uuro91V2NrdcQAAAPPSURBVDjLYsAE7JgiQvxMjGwsjMxMrCwsHIxMzBwijFLIygSUZ8k5OzslJDg7gYChhJqaqqk1MwtMjdZTxZs5WY0NjY1ZDiDQwMNzmTMnx12CFWbAM/HflxvS0tLCwpqbwxwcwprTwniWa9+SYIbIi1iWJXjt3DHDc2LBxImeux5M3rl5m6enZyGXEivUAKVSr/jp02dMj4uLnzFt10wnr5L4+Lhp+7jsVNlA8txWxZ6BE+7cfzh1S4AHkDFpUl9BgEf//VjPoodGGtzcAAAJAfb+ABM4tatG1NaIqkzO0kBFQUFETW5ASNJkemtNeogWcxkHACk0skVZz66IUVBqbMpFgmJBsW7NH8pRTmmGQUYuvQMAAA8Ks39ZqViqzO3AncTJrXhBd+zAncFkfctpTk0MvQEAAA+aHEx3orCrn8Jh6VOhWmeixsFhnJ3Ga1l8d0wfcwEAACl1Do5db3luW9qenOigiq9NUN34nOefb6JNlUkOPgEAAAY/uFxRb01tcFLww1PIWmewjpSbw2GgjKOMknAOPgIAABFDjWR3RIcVSFLynlPxWWeKXZObxVOfjFdGqGYJ5AIAAALkUKREVFiwtL737lPzWq7WkLabxVOgjFdXQURtugUAAGLdy5mywq+lO3Dal3mJX6PWrc2/5/w68URXerhjiOgMoDel5NzPVbpEuHVOPXvk0LeIlS1dsX/fv1rYXuUSUpUXD7SCsbRwW39+VLjb1bCFx1ubmhz9Wq+fPF5/wW/jhP64IFaQgpl88bER/v5L129sj0xa6xeyOCS7Para7/r0PQmzbEHenBwdc9XN/+L5lUvrUk9nZtQ61tVVpKZWr/CQeWAMdINQEOeS5Bq3Fv81oUlNdZkZGRm1FUmhoUnVGS6VYuaMQAVeAcnZ2ZERV/wvpi6uaW1N9nWpDg0NTc2sbWvLNWNhYGAp5jyTXHPBLX1pRYjrlqlFk253rm9Zs8bfP7ytMqsYaAVgwvtllzU25+a61ifnTdzp5bUv7t7tzo7u7u5OUR/e/UBfSD/TnXJ3e2Fh4fbtU7y97ezsvJ1LphUVFcU9eqQzRUUYmGsky0r/JMzcs2f37t1OQU7O3s5BQV4lJSVezgn6+21AiVJaefbMHQWxMUDwK7C/r9cjwMOjtzfafbL4LHVIsmYqU9wqtnpVvesSV9cUHx+fhuXLs3KWLZMVL+OHKOBWeaywddONG5s2R0dHuwMBL68778+bCo8l4XnzqQGXt7e3PQyAXGpnx1WmDs/dwtJsjEwaQsxSIhyCgiwc3CwcbIJsHFoiIEkAqqJ3a5aRx5UAAAAASUVORK5CYII="
const SPEED_MONSTER_DIE = "data:image/png;base64,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"
const DOOR = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAQAgMAAAC0OM2XAAAACVBMVEVRGAAAAACVTQGAHO2uAAAAO0lEQVQI12MIDQ0NYQhgZBBhcFqoxcLgpajUwOC1UAtMtDB4Jaq1MHg4sIAJCBcsAVYCVgzWBjYAbBQA8TcS0yJ73RoAAAAASUVORK5CYII="
const DESTRUCTIBLE_WALL = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAACVBMVEW5ubkBAQH///9VzuObAAAALUlEQVQI12MIBQKGrFWrVjI0MDAwIgiIxKppq1YxMEgwMCAIqARQhgFFBiIBAKX6DvO8+gE5AAAAAElFTkSuQmCC"
const UN_DESTRUCTIBLE_WALL = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAACVBMVEW8vLwAAAD///9LARpnAAAAHElEQVQI12PQWrVqJUMDAwMjRcTU0NBAhlAgAADV9AuZ84WyfQAAAABJRU5ErkJggg=="
const SUPER_BOOM_BUFF = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAACVBMVEX4uAAAAACsfAD4tteuAAAATklEQVQI12NoYGDgZFANDQ1kkFq1QhBINABZCxgdGaQaRBkZpBgYBBkkBBkCgQRjIoMEgwAjg4SoQyCDJAOQK+XAupBBamrYQogpoUAAACCfDX3F0Gu7AAAAAElFTkSuQmCC"
const TIME_BOOM_BUFF = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAACVBMVEX4uAAAAACsfAD4tteuAAAATUlEQVQI12NoYGDgZFANDQ1kkGJbkMggwdggyCDAwMAIJESABKsDkBAIYGSQEAwQZJASDQCqa3VMZJBawLqQQWqFGJBYGbUQYkooEAAAxAMNgWt8UFQAAAAASUVORK5CYII="
const LOOP_BOOM_BUFF = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAACVBMVEX4uACsfAAAAAD5opkLAAAAOUlEQVQI12NwYGBgY5BatWoRg2poaBCDaggTkAjQAhIOnECCgQmTaOACEgmaQCJqaRBYG8SUVUAAADI/D2AhuIhaAAAAAElFTkSuQmCC"
const WALL_DESTROY_1 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAAoCAMAAABU4iNhAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAJNQTFRFSiYYdTMPkTAReEYsc1QNrjQoljMoVlUGR3oScRQMqTAXsUgzk00wbm0TbDAsz2tV+IV014Z00nZqsYtJtmtR86yW97em+smz1JGI93tu85GG6WxYjk4RqJiSdU9LjnBQxk05hWYUTTUvj09HqHI4zlVGi3IttHJu0aptsVVL8smUsniAzo5Wl1dm7al45FdL6FE5XNKQXAAAAa5JREFUeJy9leF2giAUgJGEbeICTCy0bW5pra2t3v/pdgFNTVztz75zkJTPezzcyw2hAAOz0E4W0kJp8yQIw7t79IAjQlgcswbigc6Cu0c0x4wLIT0kZ+QiNGaQqmx5BRWHYMZcKLXMlCEb0niZEvCpaAWzFrlBTFJEwbpvOld3DM0na14wkOF6Nqc4+85cKvts+iNhrWde4Y/m80vKSgNzk58oeEVvM4wjQzN5IDBMzE3F6rosa7gw+9z+HlKW2y3arVTe7rs2b7M2DT2EeF+gFeS1QQkwyf4y+2ZFfSzQJ7zg0pjnEHPPk3FIF3MnZbcZhMiJlB2MKQbmxPZ6zNtj/rcpRVOvuqA0UbkeY805pbQ915D7OI49Bz6K1lswTdc4NxDc9hLqqsa1EVshXwnnCQwgTVMz4MrTmBJoGW4hNaMyZ9ODZGDWuW0DJu3qGypkXA+AZJgxnncVolyFjOEMJ4NWIWGX/CYhYrCzh2kzutnEF2blMU1KOMVSXTXbmCNTii67TUytwdSqa31FwSu02Zfl8dg/suaujHCtOW/uj6dTVaHuP+NXoCffbP4AfgBvfieEEnQAAAAASUVORK5CYII="
const WALL_DESTROY_2 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAMAAAAM7l6QAAABtlBMVEUAAAA7dg49aAA7YwFbSwCNtXOLtXF0smiEsm90s2hGaghGeSZ+r2lWWAY5XwFpsV0BNgBsRQGEsm+Erm2Esm5TUgJed0eDpF1LYAU2WwBfqVYGNwZFagh7q2d1TgqBp2duTAZiTwSPllOAm2F5nVZyTAiArmqMrmxiSQGBs2p0p2ZgVwhzsmeDsm6FcipsrWFQWwWUkEtzZx5SWgdgVwZblVBGWgJmpFlVWAUcMgJNWANhsFlZkksXNQM+YgQ5YwFVn0ylLgFmRgDOvpf+pI75cVLgSCbtwaj+o4r7dlbnTy2+LwuxLgdUTQD+rJTtVjL8dVTiwqLhwqLfwqH+dVL7e1qYeDnoVTKSNAHTvpn7rJP2cVDkTy3OTCfdRiSgOx/JLA22MQqEMQauLASfLwJTTgHswafXwZy/u5H4o4z0o4n+nILxnIDmn3+ajHiRhXeEsGy0fWSbm2O9el+amF6fl1z3d1f1dlbYdUrwakidgUenfEe5WT+1VTugdzmPdjKIZyWOZiN5Yx6FYRzQPhvOMxN1Tgk/MwinMgZJNAROVgKGPAKFOgK2JAJcSgGGOQGNNwGbLwGFHb3KAAAAQXRSTlMABAgK0enpzsnKEAy5mmowJNHEvr29mZR4PDocF/b28e3s5NrZ2dLR0c3Hxb+2q6mfnp6KbGVjXlhQTUZELi0jFbyod8QAAAFySURBVCjPjdAFUwJBGIDhb0E9Uuzu7u5WDBBBBOkuu7u723/sHstx5+mgz+zs3bfv3NzMAqaoToiPD68EZq/IgahM5dwEj7KMzc2ro3wrZjlicsPBGN/hzUsik1tc43xu72c0y63DP71H80B6chxPVXI6Agb6DfxHbuyckVafKlMwU68sRURLSROJUmXtAGsGo8FWKgWicn4mDB8ajMYNBNsqlWr5uDaP5JIlFccOghO1Wu1wf/SQfO7Q62cxPW3fLATPJOYNtpF85ZxkOa8F4J/CAtYukssDU6yHIoD7Ny32FPl3VkjLCmUB9AtpAogQEtHDpD9uDQGib51eXJE5gxJTYjGFd/xoHGJiTh1F1fQBrNuUrIVMIFAhPeYj2NRxLB61Sknetet09i0Ep2oOves5G2iSM5PJtGeWgGeaw3Ib7CD5woKnSwn4NVyvVvI13Pk0Gl8BgseRb4oHSW6iBzlAt0TAhSCCvMe8NWln7Kz4AnFpegg4JQmyAAAAAElFTkSuQmCC"

const MONSTER_DESTROYING_1 = "data:image/png;base64,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"
const MONSTER_DESTROYING_2 = "data:image/png;base64,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"
const MONSTER_DESTROYING_3 = "data:image/png;base64,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"
const MONSTER_DESTROYING_4 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAMAAABxCz6aAAAAmVBMVEUAAAA5hw5ZsVdMnjYuoi7JdTv9bUfiY0JxMx+uSzGAdm18c2ltsF/9eVbPVz3w9uvZx7io0Ki5uIV+snxcJRi43ribmplyvHA7hg4RDgrw7uvc4NjP6s3T4cXBwcD9q5iYz5SXzZKkvoqHxIaRh3yceXQeHBvW09LLysnNvq+srKzDsqWEhYaYjIFcXFtXV1hLnTU+ZC4TGgEoV/6BAAAABXRSTlMAJMJ2C5Gnew4AAADiSURBVBjTbZFHcsMwDEUJyl+s6rIcuff0ev/DBcTYEy3yVsQbDPlBKEVEaoKUFPBAE2dTScB79iczAKRiW9fNIYqZLfavdd1mKs6r5Wp7yoiJx+1qWTU6yachBA/GBz88VnOtdLMePq/WmTw3zl4/XtZ7rWa6697OlyJncDl33UKrRGw2uySL3fPmIEoePbYii/YUJ5E9DIMvmkxmv51gLdFdAq4fx/GndwDd2gBTWtv31pWGLUlbimhKxqQTPLHMGQPBSNokxVligliRrG5fKtcbkdJ2D+cBkQg0HYPLf3f0C2kHDVv1ACXOAAAAAElFTkSuQmCC"

const PERSON_TOP_MOVE_1 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAArCAMAAAAJzfvtAAABGlBMVEUAAAAkkFVIkABIbABJkFU9tQBJs1UAkFVJbFUkbFUAbFX8/P9ItP8kkP/Y/P/Y2P+02P9stP9stFWQ2P+02KpstKr8/KrY/Kr8bFWQ2KpIkP8kkKqQtP9sbABItKqQ2FWQtKr8bADYbAD82KpsbFXYbFW0bFXY2KrYSFX82P9IkKpItFWQbABs2P+0bAAktP/8tFWQkFWQbFX8SFW0SFVskADYkKr8kFVskFX8kKq0bKqQtFW0kFVIkFUkkFWQkAD8tKrYtKpskKps2FXYtFW0tFXYkFVIbFW0/P+0/Kq0tKoktKq0kKoAkFU2bAD8tP9skP9s2KqQkKqQbKpsbKq02FUktFWQSFVstABItADYkABIkAAkkABsSAB0Pzb/AAAAC3RSTlMAs3Fxs3Gzs7Ozs6Agl7AAAANYSURBVEjHdVQHe9owEDW2Ga1Bko2MFx54sguUQJNmdCXde6///zd6knFoYvzuuw/fxzs9nXQ64T80BVnTNF1raAz67rtRrwkVqMs+NQojxRfVtRKTr14TJw+povQUBSGMcEYQ6iGI0csANMoqNU2n1MAK43eJ2lW7/RcQAUgW+LJc5lsGUjgQ6aptgN7NEISgaRC/lFA/o7v18vVn7RlX4ECKpR1Q6LH9Y9JXVYsQQlkNu4Qe9vVSDQ/obv+we4KwgsAKoJ5+SMFQAJgQ4BfcAth/UFKQLZz/x+0mkBIcruF/XO+/soavWCmjuoamZmXoML3HFOQDNx1QAimjUgI2Ar9RF8oZYoP30u31MS16qQzWrQQRhMELoxnsvwpiQ9N16Lq9Waqmw/rVaH5zPLvdaRfueG+BXvEe6rJQO3ecTrvTAc9/X3fO39Zq4qEa5KeB5XnO644HzL3dc7zxx8BqNErrQy/BO+CcG+7ZeteAm76hUZs0/MDASFWBUzK1ixVKNW2f0fytUQzvDYMC3/sYKgaHb+Zq10BwG680+fo0H1w+7o2UvYKt20/GT+wPe4WRkmXLpSACW2pNV/Or7aNoxBVg12P70+f0JD1ZfhnbnY7NalCiR4vNVTqNJUg4WodDM9luImyoqs3XPzlNtol5cmqrXIEQ9Ghhmom5Dt8dCW48SAb3B+bpG9+y4PXratB/ttkeb48fPw76LLZmfvDszcAcmOHwqAUKQ/O+OTTjCxkmU94/OHofRRGO8iiwziar5XAArPC5CzXM0zCZp26L3UWGEUKYG9o53MGfu26cs6SWwKqIXelIADg6n3i33JvchZOUXPdCcuGcAHd23jx3vDaDd+0q+MRhJM65DeDPYOaxs+LWnkGsOrJQgRqrGtBX2znfIgxPx1UJ9SeUTyXc1lnP2nyiYZirzUoFi71pRPTxuVNzJipFECOqVypoLzGbEnRydpflP6V8ClgPK2t4GESjaJS9+sk7WZxcYhbDXK1CfLlZHC9Or85EHv5Inx0vNovlslJhujKhY36lOV96HiYQJxerSgX3AvpqkIbv8gxxHUL/DOJpZcJ0xXsyFe8UCqyPp3Flwt/pOlwnq7kg5Qrf58NwHbrVCpLkxmCtonfcFotFiPf4B0aIdETBotvKAAAAAElFTkSuQmCC"
const PERSON_TOP_MOVE_2 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAsCAMAAAAtr3oOAAABFFBMVEUAAAAkkFVIkgBJkFVIbAAAkFVJs1UAbFVJbFUkbFUks1X8/P9ItP8kkP/Y/P9stP+02P/Y2P+Q2P9stKpstFVIkP+Q2FWQ2Kr8bFXY/Kq02KokkKr8/KqQbFWQtP+QbABItFXYSFX8bADYbABItKr8tKrYbFW0bFX82Kq0bABsbADY2KokkFVsbFWQtKpIkKpIkFX82P/YkKpskKpskAAktP/8SFW0SFVs2P9skP/8kKq0kKrYkFUkkAC0/P+0/KrYtKqQkKrYtFWQtFX8kFVskFWQkABs2KoktKoAkKq0bKq02FX8tFW0tFW0kFUAkFVItABIbAC0tP+0tKr8bKqQbKpsbKps2FUktFVIbFVIkABsSABZRCL/AAAAC3RSTlMAs3GzcbOzs7Ozs58B5ucAAAMgSURBVEjHhVQHe6JAEEVBkxy4haWJggXsNerF9N5zSS7Xy///Hze7IUcC+GXet8Lsvu8xvhmQ3kRByqUBu9mRM5hlWMklF1ex7QEtJ0EsQ1rLYMvG+AipqopUggRUKjLXleu5BLeQL1ruANhVVaXE38YM66Qs8jK9GxtyUtsiaqRNMTYBwIec76AyM1J1l8UZIrqu+zrWsU3Ejti1jKS6TdVNUOJM/5DXTnntkb6dVq/yE6pDES7nRVHli1osoX4BHFE50Q9jdqReZZnq4gyQDGpdZNSejtW1gzORfvqarl223HK2PlXdlO9SvmiMXZRFh6lh+Vx6wursiIr/SWHFV9sS3Cy+S1zoECGUDPgVfl37Z3HVvH+eGqGN9RiM1Y1s7YJUOBgeDCsVzYwxqcAenGRUIhvD6eOvm+uSFqNy/Tgcwom8UPrKQlHiOpirs0lYqgDrZZVKPGfYdU/3eh2A98oVgnQGnBSwTtXWp3az4bSDF89tlyKYRn7+MUJJ3Gsm01XUmjlOcytov3S0Co4jjLPVCQJ1p9FcCvVC/aoczbqo2Zyb8535fL4zAfYEarfG9yc9r+fVvEhd9A/5Qt00v5/cPnT2f5yYoXAnlOtyXslLHBC5i/Fgs0rLBNRNTWM7+7cOxMPefEfTQq1eefOdURbe6aw1/spsLDrqk9nxbmu3ddzyiQ95WHxNXu91gvZ5+3LE/UGIv9Nd2t0E0AFF8Ew7lF5Hw9kCT/t9SZrYBKWRmPWg3XSajf5Iyk1Dhn2MsS6WL9Y2htpfxzJoOJ3gCdRvQhMDNFP4DXdiVT68odc8DkXi6ljocb5ZAo9AnyXVpf+OyqJ2nWjP/m/7h3Ht6cid2dyRwRdmVsQkDpD4PjIpO0b3M/B773QyLQzXhpMr8vyunhWy1Wue881x9jt/eLY2ZS6oV+ndKvX+Je/BMngS2Yax1211j7vjs2w2eAQdcIJOXmTKdH92vns+uxytoP+tNYJGu9OTFJEulu0tp+F4tRV0ZR06MOqPouz3c79hytMR9yC+Xwag3hwJ9fdjo+bx9z962vuhLAB98bwo/gHpH3Ch6bLz4QAAAABJRU5ErkJggg=="
const PERSON_TOP_MOVE_3 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAsCAMAAAAUyMtVAAABEVBMVEUAAAAkkFVJkFVIkABItQAAkFVIbABJs1VJbFUkbFUAbFUktQD8/P9ItP8kkP/Y2P9stP+02P/Y/P+Q2P+Q2KpstKq02KpstFX8/KokkKr8bFVIkP/YbFWQbADY/KqQtKr8bABsbFXYSFXYbAD8tKqQ2FX82P+QtP9ItKpIkKqQbFVsbAAktP/82KpItFX8kFW0kFUkkFX8SFW0bFVskADY2KrYkKpskFXYtKq0tKq0kKpskKqQbKqQkFW0SFWQkAC0/Kr8kKq02FVs2FXYkFVIbFXGtP9s2KoktKr8bKq0tFWQtFVIkFW0bABsSAC0/P9skP8AkKr8tFXYtFUktFWQSFVstADYkABIkAAkkAAkbAD3Zsd6AAAADHRSTlMAs7NxcbNxs7Ozs3F9qpL3AAADQUlEQVRIx31UB3vaQAw1UEiH4XzbGzA22FBWKGQ3bZruvcf//yHV2bgtONen70L0fU960klnYwe1W/WqGTVDh/qTrugKtnek1PIls03bNM0QERIik9jENG0keFWjqCY5CRHQiYnxCAwT8ABYcHlDxIwLFBJFIJhaVttqdykBX2mEWNYrAW9YkQ8RjBXfsyyMzQKEMFmpCOov0o8oZRRjDEcpFhoJrygcCZTnorRNVfXKSKlg85sUwrwiPGJ0TcxdoERW7xR6GBY9QP4Cw1LB1Peg5rD7q+3hCpkaaHsgGr5SqN+0RyG+KbuJQiYODvb5TaN2wK8wZNuvnzxiUrOxt6RQN7RnYdfQoXnr4HWXUUrxH2OjhEM1etRmTqr2qDxZuiyLqfYA1lwuHafdyTr58ZzOC+dnU5db8iSbfXScFNh/DCK+OJwn9Wp+yQRmVtpJO/eBdx9M/TrgcypwshdwD6bwCBHLAk7FLIxMsTOJZmN2JdZwg9RSOfePRUMSItH9++oaR8mxDXwy2ip4qffB416pQNUer9fyqKDfmfQXp5/i6VApqOoz7+zs4vzi/Ows86APj9PQnA7jzWL8oA/81oPV98j155spMlUPinG+8N3IP194XtlDHLtz3334ttUwJv2B3zvsuYtjdUuWxa2udX06fzx/fL3huc+oOPl82vN77iB6cBsUIvfQjdzxoi45o5i+x+h4GoM9m2IEPuZMyvEi6h26/uDpxGg9BQV/sIL6YBYkh4lsZA9tlDuI8R/QZ8Fq3YY7mlx+DSaXRsswsufqi0dzGxVHKczuAutdEAT9wGjszHuZQs3t/ICV/8+c7e3fgT8Q+w+c1MuZ5QQKz6npdxu6BsCXMt+kNs0hM13AvYypN4ZxG7Ir/jMCPmFSv+Gs+LzyzHGWTmoJot604FoF+QhBABLKubtcPhemApPaHl6z6dAerk+MPKIxE8gGPzkydOi/2sSP45NXW/fb6XEcb+KLC61CMJ6/dN3r1fbe3wz8+cu5f9nXKkwu1V6tBr+2EQ8HsGU9mK8Owbjn9g4HD/P5w5YVexyMtQHvgqgXuau3RqngR/Au/qPQuh2Mg/GkrBl2VPnwBv6DhjKNl+M3nFh1JNJlZF0AAAAASUVORK5CYII="
const PERSON_TOP_MOVE_4 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAsCAMAAAAtr3oOAAABHVBMVEUAAAAkkFVIkABJkFVIbAAAbFVJs1UAkFUkbFVItQAktQBJbFX8/P+02P9ItP/Y/P/Y2P9stP8kkP+Q2P9stKqQ2KpstFW02Kr8bFVIkP/8/KrY/KqQtKpsbABIkKokkKq0bFVsbFXYbFXYSFX8bAAkkFXYbACQbAD82KqQ2FVItKpItFX8SFVskKr8kFUkkACQtP/YtKqQbFW0bAD82P+0kFWQkFW0SFX8tKqQtFXYkFVIbFW0bKpskFVskAC0/P9s2P+0tP+0/KoktKrYkKqQkKq0tFUAbFUktP/Y2Kps2Kq0tKr8kKqQbKr8tFXYtFWQkAAUbAC0kKoAkKr8bKpIbKps2FUktFVIkFUAkFVItAC0kABIkABIbABsSADjJJIoAAAADHRSTlMAs3GzcbOzs7NxcbPVfIxkAAADTUlEQVRIx4VUh5aiMBQVLNsIJCQ0QUCUooy9jVO299777v9/xr6AeGYUzt533iE5ubk+X0ntGgSxLgqicAt8b7VK1HXHcDTwwjTurVY5W9A1W2mD2VgBtxU7Ww9YGflWfeDYWJIkRUKYIoqQAjuAYZTRmYFsReJ0TAmHQ5Vsb+OHhl4/pGu5FlYQIkQmFiEUSTkURdOP6O3sBFFKNcqB8l8DtEviN3CmM6WE8qi5KYV6m1WoYzR1KC54BfBAL4l9CSdI4do5loW6VBX7Hu3iWx17FZS2c6wOeagCHhzl/ath4wptw9Bbxx0Ddb0ae+E21PSWUDtEM9UfYunIbG0rlHfkTzbQDHQVBtWcol+O9Sdh6jL5vkwKH7IwPdS+mblQEyY/wjD0ZJXbMPNH3uTZRICzGwVZ7NztxN33l1ume+knzwPeFfO8b2Gq6/ViBhvnCz8KouDdzEAv5UfqI9VVLfCh5XI2rBgx0D7vjbs988Q8GT9OsERIrmmNRqMvI4vlO4KwYmj1/EKnGwX9k745PpUwJbKqqq61fuNf+BdPnriWzNWpzSfWaQmZ+ibo9XvjVYJeEJZr+6ue2TPfrHJ9QnnnY5u1OP1mpxvP4/l6vWVMfq4+V0eWf9E3+6Z/4Voq3GbZzLb3fSPmJqTecKcewL8x/TNrlMeezZl9OFE3QpfIsuyQs4/jz2Pz7DGDGWeyRg30Aiez7eXBi+a+nCKKHqBZcnp6msySB4jvmabrT54+frtadeOjV4xDwu0lGIYlVrDGfodZ/oLIv0q/7WroHkIwrffA0W6NmP5s0nnPq9OLrqmHQ5KBkeILLqfQN5m6GfWuxe4Nrez9suRddQnfe+GHyZ+7m2gT+ItrmUmZNqUUamtZnC0TQqd0qruTZgOqz+0w9uyNlEmmTR8oGPaafqPqfc+fSeZ6KnQymeFkmcwGl2VkUIdZBTo2hmkzbIbn+urd6/HZ2/W6nC5stWQJk/8K5q1Zu9E4jwLeO3G3Vo7Lp1DP5NXT73m1xU0AuTbncYV6vB6/hl7xxf2cgXovnleod37x2vnBh516vIBcR91OBT2eg9pJtBEbu+t3eK4bNyvof2M+RVA7oP8fNzvni/lifpiJaogNMJisSvwDUsh5ZmuNSFgAAAAASUVORK5CYII="

const PERSON_BOTTOM_MOVE_1 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAWCAMAAAAcqPc3AAAA3lBMVEUAAABIbABJs1UfkFVIkABJbFUkbFUAbFVJkFVItQD8/P9ItP8kkP/Y/P9stKr82Kr8bFVsbADY2P/8/Kq02KpstP/Y2KqQtKpsbFWQkACQ2Kps2FW0/P/8tKqQ2FW0tFVstFX8bAC0bACQbAD82P+02P+0/Kq0tKpItKrYkKokkKq0bFWQbFWQ2P9s2P+QtP8ktP9s2KpIkKr8tFWQtFWQkFVskFUkkFXYSFVskABsSABIkP/Y/Kr8kKq0kKpskKpItFUktFX8kFXYkFUAkFXYbFX8SFWQSFXYkAC0kACuRX2oAAAACnRSTlMAcbOzcbOzs7NxarD6ywAAASNJREFUKM9NkYduwyAARHGdNC3bYDsecbyyZ5uddO/2/3+oxI6M74SQHgc6ABQK2/bFwRWoZG46sNKAVrwroMtcyZhwXSlgteOejf1ZvuXc9/Jt1AurPFt7+cn/5pZ1+htLnZe9+Dkerp/iYTxkOh/aUEu4ulEjeCSwsCShCbRuV9RZIMdZjFRY908oXSE8wQi/jpKq/81AkDlVUNnpCBgkxdmJC8kS4TtcDGQTKc58+jFm/UDBi5ckep9mAKQ8+6IjjMvzMab0d5pyA/xkltV60/nPveXPMlBqghB6UFBp39JFr7t9MnfObfqkfoFGIOHgxTSp+oeuWctvItbeAeDZEds1NDe8VL09APks5Uejxo8H7lkAWP6BGzWuSLNYb6q51D+WkB4U+e13DgAAAABJRU5ErkJggg=="
const PERSON_BOTTOM_MOVE_2 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAYCAMAAADTXB33AAAA6lBMVEUAAAAhkFVIkAAkbFVIbAAAbFVJs1VItQBJbFUks1UkkP/8/P9ItP+02KrY/P/Y/KokkKr82P/82KpstKps2FVsbFX8bAC02P+Q2P9stP+0kFWQbFW0bABsbADY2P9s2KrYtKq0tKpstFVItFX8bFWQbAAktP9IkP/8/KrY2Kr8tKqQtKqQ2FWQkFUkkFX8SFW0kACQkABsSAC0/P+Q2KrYkKr8tFW0tFX8kFXYbFVIbFVskACQtP9skP+0/KoktKr8kKpIkKq02FXYtFWQtFXYkFVskFUAkFW0bFUAbFWQSFVstAAkkADYbAAx0IgDAAAACnRSTlMAs3GzcbOzcbOzI0Nw/QAAATlJREFUKM+FkudywjAQhGVsEyJZtlxxx7gk9BYglPRe3/91IgNWbGYy2Z3TD+18o9NJgIk74er7AlXVWoq8c6iEBldOYqwgJozLWaujPrYv28veA1011eBZwg/UnpfNpmPLDGaThRaXKW0xNQPPSrdmNoyOqE7Ujbo9DXcjLUT1EsUNLhDTTR+UxRtzpSnnxrhgGDci0nnuhHxxZSZu6fAWSrnvbYxd1/P3yekTlq8g3Se0dCeUl2srFfJENGTUtKFUWJ+7kwMl6B3UdCR4BmlRj0Q22bdn1yXJLzUq2hA2Vup/vBKyO8uxsZ1wjPJ8IXhPHFuihCMjpNeq76VrKr4msE+nYvCVSJimq+FQBC+KiuIDdegmMK1xZgKw7a/uPhtHPyDzG/SWs8nY2gigqoL+XtfAvxL/TH4AeqMgJpYcE1MAAAAASUVORK5CYII="
const PERSON_BOTTOM_MOVE_3 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAXCAMAAADJPRQhAAAA5FBMVEUAAAAkbFVIbAAAkFVJs1VIkAAkkFVJbFUwtQAAbFVItP8kkP/8/P/Y/P/8bFVsbAD82Kq02Kq0tKqQ2FXY2P+Q2Kr8tKpsbFVstP/8/KqQtKps2FWQbAD82P8ktP/Y2KpstKokkKpstFWQbFWQkABskAD8bAC0/P+02P/Y/Kq0/Kps2KpItKrYkKr8tFW0bFWQ2P9s2P+QtP9IkKq02FW0tFWQtFVItFVskFUkkFXYSFXYbABIkP/YtKpskKrYtFUktFX8kFXYkFWQkFVIkFUAkFVIbFX8SFW0SFW0kAC0bABsSAD6RPbwAAAACnRSTlMAs3Gzs3Gzs3Gzh1GDGwAAATVJREFUKM9VkYeOgzAMhgMtHQFC2LOFsrp3r/P2Hu//PucOQfgsx5LtX3JsVFA72yVW4HxPNVVwsDpbaOh9qWDkMQq944ahFlpUCx+oITGqMZ2mtpIQktnB26zjc6WGzuxASb+Iovz9TF1W43aetDttZm3gpYwG+dpQKhioDVQijIfylaHhQ4Gh1YvwEjvYWdcRS133onVXFMWuuIt0r1X070eGvHREfDZnYUhmfF0RH1NJXmHovzhWZdeIz9MJ369TOjAhfbOVbL3MT6D4zMnvfDIRIdm7+G5ymudEAE0S8Er7udR8HPgsCYrpehjje0gDh3blPvpAXkQwWd+Qqx8STFcaPdZqMdxJr+ygubXodo+QvbGsd4GtKHZOUhuhIMlJxrMVPjvCbaAjPRJUheObiLvFK/8GRB+h5GY35wAAAABJRU5ErkJggg=="
const PERSON_BOTTOM_MOVE_4 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAWCAMAAAACYceEAAAA51BMVEUAAAAhkFUkbFVIkABJs1UAbFVIZQBJbFVItQBJkFUkkP/8/P9ItP+02P/82P/Y/P9sbFWQbAC02KpstP/8/KrY/Kr82KrY2KpstFUkkFX8bFXY2P+Q2KqQtKpstKokkKq0tFWQbFVIkP/8bABsbACQ2P/8tKqQ2FVs2FX8SFWQkABskAC0/P+QtP8ktP+0/Kps2Kq0tKr8kKrYkKqQtFVItFX8kFWQkFXYbFW0bFVIbFUkkADYbABsSABs2P/8tP8ktKq0kKpIkKr8tFXYtFUktFXYkFW0kFVskFUAbFW0SFW0kAC0bAAwyaJ5AAAACnRSTlMAs7Nxs7Nxs3Gzq8HQxQAAATJJREFUKM9VkYeSgjAQhkFUvEQgBKRXQU/BcvZ+vd+9//MYcCCw/ySZyZ8vu9kwRbAdtpmJrEw1OKcnFRpVrJaBVRFCeBu2fketB1UMXoLF2zJwg4UmjhqF0bgXh0i+JOMIxZe/lWZUGG2VhPHOshIk74Z1RrV1XX3SdF3XbLVJGXY9gWXMPWpk1blYIDEQHJxVRpmTab52+0Tgwz+xxSN/z+E77ike6OZ69vAtT/sYWfuhJCjkvE8MALA0dzutjAllFJQE0VSCsEkT+TMAyPaMDFdQbYMva9tQxtyEn/tzyXhYGCgZ5QPzRz5EFld0wYFQmIJu/1EZmGY7RTL9Hwgnik9yaKKRd412zoaO0WLQl7U9clWn/b1drhHDyGE0Tvmak46t/G4uJnPN4f8PMV/bugLXRx++3LmwjAAAAABJRU5ErkJggg=="

const PERSON_LEFT_MOVE_1 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAMAAADX9CSSAAABCFBMVEUAAABIkAAkkFUAbFVJs1VJbFUkbFVIbAAAkFUoSAD8/P8kkP9ItP/Y/P/Y2P9stP+QbFWQkFX82P/8/Kr82KrY2Kr8bFVsbFW02P+Q2P+0tP+Q2KqQtKpstKokkKq0tFWQtFVIbFX8bABsbACQtP+0tKpItKq0kKpskKq0kFVskFX8SFWQbAAktP9IkP+02Kps2KpstFX8kFXYbAC0bABIbAC0/P/Y/Kq0/Kr8tKrYkKqQkKpIkKrYbKqQbKq02FWQ2FVs2FVItFXYbFW0kACQkABskABs2P+QkP/YtKr8kKoAkKq0bKpsbKr8tFXYtFUktFVIkFW0bFXYSFW0SFVISFVIkAAkbACmqrr/AAAACnRSTlMAcbOzs7OzcbNxpLsHWgAAAVlJREFUKM9VT+d6gkAQPIwm8Q45QKSIKIIiCmqsscee3tv7v0kWVDQz3/xgdpjdQwglzOx9tpzNgMrvv0Vz5H8nkygez6RwhOvcvGUqDKRrN1xmR1ES0xjrrRgKsOGFYhW05tuyJOIU5hbngc93iz3eB3WnL2LYdRXmBaEgFCqBIB1uiIMb9qfxjjgFMBi0Q0xXMVggrk9pY3mGDoMl1UuappV0liX5/CWKBk6eJUCWAp0obwyoQ+qEpSoH/ZoR2/tms98I8pTlUrBIXYR/JJjqa8kgBAak1BTTh/t9XvbGLuSB1aehhLn5/r2y9exCP5kJK2skabl8uIC5sJXJpB6kZ5ZXqdySt+iix1jDoXQsTNt3ORYecESriTnVLauY06H9CL7w0HZrxgCuYY4ugzpfsrftCTlpaJ6klc1HZ9VRbH4tW7WL0x4G6Nvyp+Vtwf+PxI9iK/b+4w8sJykZ4p/BzgAAAABJRU5ErkJggg=="
const PERSON_LEFT_MOVE_2 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAWCAMAAAACYceEAAAA6lBMVEUAAACQbFRutFRubgCQ2KpstKokkKqQ2FSQtFSQbACQtKpItKoktKpIkKqQkAD8/P9ItP8kkP/Y2P/Y/P+02P9stP+Q2P+02KqQ2FX82KpskADY/KpstKpstFVskFVIkP/8/KrYtKpItKq0kFX8bFWQbFVsbFWQbAD82P/Y2KqQ2KqQtKq0kKq0tFX8kFXYSFX8bABsbAC0/P8ktP/8tKq0tKr8kKpIkKokkKqQtFVItFXYkFWQkFXYbFW0bFX8SFW0kADYbAC0bAAUbABISAC0tP+QtP+QkKpskKr8bKps2FX8tFVIkFXYkADwyp6ZAAAAD3RSTlMAozo67u7uo6Oj7u7u7qM4Zh/QAAABKklEQVQoz1WR2XqCMBCFUVu1KwGyEEAFRK0bUOtu1ardl/d/nU6UJZ755mb+nOQkUYQqNdMxj708KJKubTVTr5bPixeurp7qAZBuZqTQ7D83h6KnoecCYim5almvnQ50K/ziwqWaqeelbrVENz0u5obtJKQ6sRnv2l2ui1NUoydFwFkyzCj1FTmdzQwsihKClsq5yj4CvY8Mgzrn5FZDUBRDAvydj0vlO+1Jm2uIUIjhskVyn0IQfXyCI3Hl71DYb+MBJ76GwIcaCBvj1Xp3ct2XJvqokboIGW+CraUkqpCbhg+RZ4Dmg8E0rEvpqkzV6dH5hl1uSuTShsTM+Z314Dt+VnsZdT3uLQ5KjfWH7d3aktDmL4jT/dsd6bqlIIqjZKWsYv2xDSVN/gF8pST6k/agEgAAAABJRU5ErkJggg=="
const PERSON_LEFT_MOVE_3 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAVCAMAAACE9bUqAAABBVBMVEUAAABIbVQZkFUlkFRJkFVJbFVIkAAlbVQAbVQkkKpJs1UkbFUAbABskFZItQBIbABItVRIkFQAkFRFswD8/P9ItP8kkP+02P/Y/P+02KqQ2FVstFWQbFVstP9stKr82P/Y2P/8/KrY2KqQ2KpskACQbACQ2P/82KpItKr8bFXY/Kq0kKr8kFWQkFVsbFXYSFWQtKr8kKpIkKokkKq0tFVskFX8bAC0bAC0/P+QtP8ktP9IkP/YtKrYtFWQtFVItFXYkFW0kFW0bFW0kAAkkADYbABsbABISABs2P/8tP/YtP/8tKq0tKqQkKpskKokkFUAkFXYbFVIbFUkbFX8SFVItABIbAADjAlTAAAAFHRSTlMAZ7Nns7NxZ2ezs7OzcXFxZ2dnJQXC2gQAAAE+SURBVCjPTZHXcsIwEEWXmt5lZFnIuOGGMb0lEEqA9F7+/1MiYWNzdu7T1ZkdSQBwOlVUhUb5PQY4yUDEVdNHAl3EpAew5db0NVRBIhXeYSVpyt16vSYyaQVP3JPJedxUy9Z9lCBwhIWUvdi561mbzMcO4siGut1DDOIYBtGNzR6NXEBMnmIdRegYj0wXUqhJiI9lPjZjkrufNlnILjuuxBkNZdlWc7DTfXRKEh88REjGNLYKxcK60y6VeHHNbI2vM2kuvo/XeH0ThhgTI1k3lMzmPgOvX3Me3MiSGJYfZ58rURXPquGLZt9sLcZai/6PBRFtheUllamSJMzavBX0IKWJUWwSjCr87RJUX7yz+942+YdMZoNM0hxSY+w80+8pJc1uuGpYSXO0XAw87+vvEgByEFZTZx32G97OSfgH/ywvnv2N36QAAAAASUVORK5CYII="
const PERSON_LEFT_MOVE_4 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAWCAMAAAAYXScKAAAA8FBMVEUAAAAUbVQlkFQmjlVbtVQAaFVJSVVIkKltbVRIbVT8/P9ItP8kkP/Y2P9stP+0tKrY/P/8/Kr8bFWQbFWQ2P9skKr82P/82KpstKq02P8ktP/Y2Kq02Kq0kFWQkFW0bFW0bACQbABs2FW0tFWQtFVstFVsbFW0tP+QtP/Y/KqQ2Kps2Kr8tKqQtKq0kKqQkKr8kFVIbFXYSFX8bABIbABIkP9ItKr8kKpIkKokkKpItFXYkFVskFXYbFX8SFWQSFWQkABskADYbAC0/P9s2P9skP+0/KrYkKqQbKrY2FWQ2FXYtFUktFVIkFVsbAAkbABh8lMGAAAACnRSTlMAZ2cbZxuzcWdnVQrmagAAATZJREFUGNNVjoduwjAYhE1Llx0PsgOZTcIqe0NZpXu//9v0d0IjcSdL1un7T4cQMtwGb9Q4b3DO17/DpBdcIlSuCVzopfuRJjcI9d9pLbNlWibGlXZ6BveR5tc9bQ9voMoYO7clhHZRfaJFw8kunHdoBQN9B6zvxX7sJevYAxLU6pazBUDkxkLQlo0ynbsCUwwRFg57IquLY5yytq434ZGFUoUFx3i2JAqYMPCqlIe2y2ZKVSFNhwohdDunk0d9KlnGKIV6uRfU+2QGsIpC+q5ZyfeGmro1DCgA3wcdE1PJaqE6fpYsefPV8av137tHV4ucVLecM+Ur65WzCWN2r78ZNDlZAntU18FUn3KatRbS4vnA+LZb2YJCh0AdPUx8bnXSIruONocgrP/AHnWIThVp4xFcyO8fOzwkhkEJlIEAAAAASUVORK5CYII="
const PERSON_LEFT_MOVE_5 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAVCAMAAABrN94UAAABAlBMVEUAAAAkkFVIkABIbABJs1VJbFUkbFUAbFWQxqsAf1Qks6okkABISAAASABIbVQmjgD8/P9ItP/Y/P8kkP+Q2P/Y2P+0bABstP/8/KqQbFVItKokkKr82P+02P9IbFVstKq0bFW0tP/Y/KrY2KrYtKq0tKqQtKq0tFWQtFW0kFX8bFWQtP9IkP/82KqQ2KqQkFUkkFWQbAC02KpskKpstFVskFXYbFVsbFX8SFW0kABskAD8bADYbAC0/P9s2P+0kKpIkKq0bKq02FVs2FX8tFX8kFVIkFW0SFWQSFVIbAAkbAD8tKrYkKqQkKoAbKqQ2FVItFUktFXYSFUktABIkABsbAAC1nOSAAAAEHRSTlMAs3Fxs7Ozs2dns7NxcWcbNSiVygAAAVdJREFUKM9VkOd2gkAQhdcWNXVZehMLIKAi2HvsGtPb+79KZoGYk2/O5cfcYS4DQqjrVMyKFcnan7rOCuWubxDKGlWCz1TtV8O5TSPgec3X4tJamoQlv59CEWO5X3KpyjuvpWGC9U1syELpIdL4aathihEbbbfert9T0Xmako2N7pqXcFwAqcJ8Qqqj0w4Uj4kuvuX/nF7Db3AcR8UsVXQmfQpUhWUYEYph31+SthwOZqUvVWnMCbBQWDW5Qyh7o7rV4SAD4JoM2x4KIdw+nMihJWGKRHQGdq7K3rSUQRTHJzzmCU/nGdaVB4cJvBHmMsFn04izoa8uUygTZQjHXg82QImiCM8gn/yr0dSUOINOc4SzRVHZp36/6lHD+gL263MMWVJncwHGUfCmZkv3GUUNClUMaFtXAGfyLciOraiXKioiVLBr5u5jdkijfxTv0FV5PJjRK34AESgxPKO5J5QAAAAASUVORK5CYII="

const PERSON_RIGHT_MOVE_1 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAMAAADX9CSSAAABCFBMVEUAAABIkAAkkFUAbFVJs1VJbFUkbFVIbAAAkFUoSAD8/P8kkP9ItP/Y/P/Y2P9stP+QbFWQkFX82P/8/Kr82KrY2Kr8bFVsbFW02P+Q2P+0tP+Q2KqQtKpstKokkKq0tFWQtFVIbFX8bABsbACQtP+0tKpItKq0kKpskKq0kFVskFX8SFWQbAAktP9IkP+02Kps2KpstFX8kFXYbAC0bABIbAC0/P/Y/Kq0/Kr8tKrYkKqQkKpIkKrYbKqQbKq02FWQ2FVs2FVItFXYbFW0kACQkABskABs2P+QkP/YtKr8kKoAkKq0bKpsbKr8tFXYtFUktFVIkFW0bFXYSFW0SFVISFVIkAAkbACmqrr/AAAACnRSTlMAcbOzs7OzcbNxpLsHWgAAAVdJREFUKM9VT9d2gkAUXIwlssACQYoUERBRsJfYY0/v7f//JMviUTNz5oFh7uy9IJ//jiZ2+fe9UqwUC1j3RTsDYlCK3Vka1/QRbCGdJn9SHZ2mr0RJLHAJb+qxnV1xNEuLktzlt2WBr2HtSL5NxsWXeZ8flCOsPk/8NGnHE9WSUIolCICAMlkM/EbCuJ/gYt1EaMjFu2CpegokuLQsyDC6p2map6M1sUneZxAmAzEt/2inTA3XcypiYAP6aGQe0iuVxc0cg+J8c9iyD/l2fG3Lg9iG0PRea1SG3LvkaGn8VIOkP5iGMh+ResvQpImzERYQ9wfPjpzce/EGb6vV0FnEE43ZTHFz1GF9xrjrzoUpQn4z9QiOyOocrVYClaNbHXAGCm80MutB96HEg3PYY8kQBvtQ/uoB6mTn6o685V2lt+l97JQzfx86n7IbAQrzH1zFVX4yp+8/zT4pGcPMrVAAAAAASUVORK5CYII="
const PERSON_RIGHT_MOVE_2 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAWCAMAAAACYceEAAAA51BMVEUAAABstKpItKqQbFRutFRubgCQ2KokkKqQ2FSQtFSQbACQtKoktKpIkKqQkAD8/P9ItP8kkP/Y2P/Y/P+02P9stP+Q2P+02KqQ2FX82KpskADY/KpstFVskFVIkP/8/KrYtKq0kFX8bFWQbFVsbFWQbAD82P/Y2KqQ2KqQtKq0kKq0tFX8kFXYSFX8bABsbAC0/P8ktP/8tKq0tKr8kKpIkKokkKqQtFVItFXYkFWQkFXYbFW0bFX8SFW0kADYbAC0bABISAC0tP+QtP+QkKpskKr8bKps2FX8tFVIkFXYkAAkbAAAbAD2TtrFAAAAD3RSTlMA+/yjOjru7qOjo+7u7qObx+ZZAAABKUlEQVQoz22QiXKCMBBAA4pHL46QxIAIolZFoN5H1Wrv8/+/pxsqGTrj29mZTF42mw2S/KybDaWRZQ39oznQJe5lQTQs2LnVrb/wK+VcMBB+EM9H7fuhyHYpr9BFBX+LO71HpwfZuTgZxcXC8aDdcbwHkSWUM8C66GTxvtvnzJ3VpVEpZbaeY5eRZG0QQm0sgrmVglAoxuNnA1CrqMi7jeEKahoQV0WxYj40p8Qwl+bEvK5qhfllBcTrSxKWsnkO280U20bLMCcgVMKjdH8U8zj7cDclJK9oja2ZdoMEXjyPoiVsLuDhakslNdmF+/ZTdppaOqsjyXHzAZ8/WHwqDF7uKlI420N3NGRN9L0KeNAHIel1TwsvDb926BxOkiahpp1Td10IL//MX1W2Izk+ymBwAAAAAElFTkSuQmCC"
const PERSON_RIGHT_MOVE_3 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAVCAMAAACE9bUqAAABAlBMVEUAAABIbVQUbVQZkFUlkFRJkFVJbFVIkAAkkKpJs1UkbFUAbABskFZItQBIbABItVRIkFQAkFRFswD8/P9ItP8kkP+02P/Y/P+02KqQ2FVstFWQbFVstP9stKr82P/Y2P/8/KrY2KqQ2KpskACQbACQ2P/82KpItKr8bFXY/Kq0kKr8kFWQkFVsbFXYSFWQtKr8kKpIkKokkKq0tFVskFX8bAC0bAC0/P+QtP8ktP9IkP/YtKrYtFWQtFVItFXYkFW0kFW0bFW0kAAkkADYbABsbABISABs2P/8tP/YtP/8tKq0tKqQkKpskKokkFUAkFXYbFVIbFUkbFX8SFVItABIbADYIzX4AAAAE3RSTlMAZ2ezZ7OzcbOzs7NxcXFnZ2cl07kbGAAAAUBJREFUKM9FUId2wjAMNGV1rwTHMQ4hDlmEsFfLLtC9x///SuUEk9O752edzrKEYmROETr5NXSqJ5yfoRSHlFcVRQECgtZ1qugYMhUIUzDgs13+gmhQ/xS2p/VGoydYToQDXREONwzLtXs74c5jWJrQ3MmybPfvYso2l8SM+1hVYlkuscgMSXh8jHHyM+iIaV4KB57KmIM1iIAQTveOnOFo2misArzuOouyewfF8IMRLqkQ3Y9s6qAcHjcddgNCqdTpbgvFQrw13apqCuaQjuPttenH82Q2n4tHDTM1cXgPbn3gD8U89s9g1WZMOm4d8yWqnRdB6YftZV1Uq6rBDDXP9I7cWUXBZFet4BaSyAwXU1g777x7Yt+BsVfs5ibqtQidf9Nnd2LRo9RTi1AOzqu/L98frtbHKEXq9puDaCuv//yNLjltma8aAAAAAElFTkSuQmCC"
const PERSON_RIGHT_MOVE_4 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAWCAMAAAAYXScKAAAA8FBMVEUAAAAUbVQlkFQmjlVbtVQAaFVJSVVIkKltbVRIbVT8/P9ItP8kkP/Y2P9stP+0tKrY/P/8/Kr8bFWQbFWQ2P9skKr82P/82KpstKq02P8ktP/Y2Kq02Kq0kFWQkFW0bFW0bACQbABs2FW0tFWQtFVstFVsbFW0tP+QtP/Y/KqQ2Kps2Kr8tKqQtKq0kKqQkKr8kFVIbFXYSFX8bABIbABIkP9ItKr8kKpIkKokkKpItFXYkFVskFXYbFX8SFWQSFWQkABskADYbAC0/P9s2P9skP+0/KrYkKqQbKrY2FWQ2FXYtFUktFVIkFVsbAAkbABh8lMGAAAACnRSTlMAZ2cbZxuzcWdnVQrmagAAATZJREFUGNNNked2gkAQhdGYtssW6Sg1gC32rrHF9P7+b5NZVj3eOfPn4zvD5aBchd108LdijNUZq9ZZ3TMVyG2afXZe0Sm8WhK4mLXKCFm2ZZNqPh89RSncuUhAra/7tR1soMfg3oOJyqQ9i7bjQayPa/EWaKnTRLntJ6vUT4LEDxQRp0k4B18OkS0ul/iZuhzBA0QQ9y6UPMWKOseG0WrA0uwAC0tMYbAKs5geTcfgnBO3gdWKOqWeA0z05XCPUCrcifGUAsz7li2vh1UVXJN+daVLkNUOH8CEE6a50fRI3rXfRlrwjoX7MtIiHdxvlTK20aQ9v1Z2ssMCs0Z/3es6lGLxUbCHy4RNDILcjiTHFk3nx+zPEv2MZm2bBePHoRbuz+hAg/f+1qJwv45vThSs4Qj+wCn/IG4khpJHhv0AAAAASUVORK5CYII="
const PERSON_RIGHT_MOVE_5 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAVCAMAAABrN94UAAABAlBMVEUAAAAkkFVIkABIbABJs1VJbFUkbFUAbFWQxqsAf1Qks6okkABISAAASABIbVQmjgD8/P9ItP/Y/P8kkP+Q2P/Y2P+0bABstP/8/KqQbFVItKokkKr82P+02P9IbFVstKq0bFW0tP/Y/KrY2KrYtKq0tKqQtKq0tFWQtFW0kFX8bFWQtP9IkP/82KqQ2KqQkFUkkFWQbAC02KpskKpstFVskFXYbFVsbFX8SFW0kABskAD8bADYbAC0/P9s2P+0kKpIkKq0bKq02FVs2FX8tFX8kFVIkFW0SFWQSFVIbAAkbAD8tKrYkKqQkKoAbKqQ2FVItFUktFXYSFUktABIkABsbAAC1nOSAAAAEHRSTlMAs3Fxs7Ozs2dns7NxcWcbNSiVygAAAVhJREFUKM9NkOd2wjAMhcVqodNx9iJhJCQBQsLeZUPpXu//KrXj0vbT0R/dcy1dA1xf5WDpdY47p+SUqkl7HUhI33jWi1tGv+CylWVSqhcqSDGaRkVktXpiwtpEGBnNYGv7xZ5Ke8QEC1GMzeNIvS9KSTMhSzdQz12tVaPtt+AHq4ypSWElrjrAOH+VTYxE4qK62U7BCX3BCYJQpx3Wu3/z5zee42RSHK/p0TF9mqd0Xptjwqyu6Z/FaT9WSe5YGrR4riEkmZHQdmrDwJYgU5wE9pK8wJlYQRTFidXxAGC876s+z1GPiEUk4tADRgZSC50obLvV+IgyuXjAUkRkLssyVXmt2z1ItpTctNNk2RWwQF2WoFQnw+SvztZtRSSpZybZMzeR8UCvInPJ3xiIUM5HusaFZrM6CaQDybGfvm+rFTcPUAD9QtdcT5W+xvQqknRkX8JtAf7xDWOoMTzimwVKAAAAAElFTkSuQmCC"


const UnDestructibleWallPosition = [
  ...new Array(5).fill(0).reduce((acc, _, index) => {
    acc.push(...new Array(15).fill(0).map((_, inIndex) => {
      return [
        inIndex * 2 + 2,
        index * 2 + 2
      ]
    }))
    return acc 
  }, []),
  ...new Array(2).fill(0).reduce((acc, _, index) => {
    acc.push(...new Array(33).fill(0).map((_, inIndex) => {
      return [
        inIndex,
        index * 12
      ]
    }))
    return acc 
  }, []),
  ...new Array(2).fill(0).reduce((acc, _, index) => {
    acc.push(...new Array(13).fill(0).map((_, inIndex) => {
      return [
        index * 32,
        inIndex
      ]
    }))
    return acc 
  }, [])
]

const LEVEL_MAP = [
  {
    wall: [
      ...UnDestructibleWallPosition
    ],
    destructibleWall: [
      [2, 3], [3, 3], [4, 3], [1, 3], [10, 5], [8, 7], [20, 3], [1, 7], [1, 8], [3, 2],
      [1, 9], [2, 7], [3, 2], [11, 5], [12, 5], [13, 5], [12, 1], [13, 1], [14, 1],
      [16, 1], [17, 1], [18, 1], [18, 7], [19, 7], [20, 7], [18, 11], [19, 11], [20, 11],
      [3, 11], [4, 11], [5, 11], [11, 8], [11, 9], [11, 10], [24, 5], [25, 5], [28, 11], [29, 11], 
      [29, 1], [29, 2], [24, 9], [25, 9], [26, 9], [4, 1],
    ],
    monster: [
      ['BalloonMonster', 8, 1],
      ['BalloonMonster', 20, 5],
      ['BalloonMonster', 14, 9],
      ['BalloonMonster', 8, 9],
      ['CrossWallMonster', 10, 3],
      ['SpeedMonster', 30, 7]
    ],
    door: [ 18, 7 ],
    buff: [
      ["SuperBoomBuff", 2, 3],
      ["LoopBuff", 8, 7],
      ["TimeBoomBuff", 20, 3],
    ],
    time: 480 
  }
]

let GOD = false 

const LeftMoveButton = query(".action-left")
const RightMoveButton = query(".action-right")
const TopMoveButton = query(".action-top")
const BottomMoveButton = query(".action-bottom")

const DropButton = query(".action-j")
const BoomButton = query(".action-k")
const StopButton = query(".action-p")

const TimeContent = query(".banner .banner-title-time")
const LevelContent = query(".banner .banner-title-level")

const IS_MOBILE = isMobile.any 

function CreateKeyboardAnimation() {
	let pressMap = {
		W: 0,
		S: 0,
		A: 0,
		D: 0
	}
	let currentList = [] 
	let index = 0 

	const moveMap = {
		W: [EMITTER_TOP_OP, { deltaX: 0, deltaY: -1 }],
		S: [EMITTER_BOTTOM_OP, { deltaX: 0, deltaY: 1 }],
		A: [EMITTER_LEFT_OP, { deltaX: -1, deltaY: 0 }],
		D: [EMITTER_RIGHT_OP, { deltaX: 1, deltaY: 0 }],
	}
	const validKeys = Object.keys(moveMap)

	const isValid = (key) => validKeys.includes(key)

	function press(key) {
		if(!isValid(key)) return 
		const index = currentList.indexOf(key)
		if(!~index) {
			currentList.push(key)
		}else {
			currentList.splice(index, 1)
			currentList.push(key)
		}
		pressMap[key] ++ 
	}

	function animation() {
		index ++ 
		index = index % 5
		if(index === 0 && currentList.length) EventEmitter.emit(...moveMap[currentList[currentList.length - 1]])
	}

	function up(key) {
		if(isValid(key)) {
			pressMap[key] = 0 
			const index = currentList.indexOf(key)
			if(!!~index) currentList.splice(index, 1)
		}
	}

	return {
		press,
		up,
		animation
	}

}
function buttonActionBind(target, key) {
	const start = IS_MOBILE ? 'touchstart' : 'mousedown'
	const end = IS_MOBILE ? 'touchend' : 'mouseup'
	target.addEventListener(start, (e) => {
		e.preventDefault()
		if(!game.loading) {
			createKeyboardAnimation.press(key)
			window.addEventListener(end, (e) => {
				e.preventDefault()
				if(!game.loading) {
					createKeyboardAnimation.up(key)
				}
			})
		}
	})
}

document.addEventListener("keydown", (e) => {
	const key = e.key.toUpperCase()
	if(!game.loading) {
		if(key === 'G') GOD = true 
		createKeyboardAnimation.press(key)
	}
})

document.addEventListener("keyup", (e) => {
	const key = e.key.toUpperCase()
	const actionMap = {
		J: EMITTER_DROP_OP,
		K: EMITTER_BOOM_OP,
		P: EMITTER_START_OP,
	}
	if (!game.loading) {
		createKeyboardAnimation.up(key)
		if(Object.keys(actionMap).includes(key)) {
			if (key === "P") {
				stopGame()
			} else {
				EventEmitter.emit(actionMap[key])
			}
		}
	}
})

buttonActionBind(LeftMoveButton, 'A')
buttonActionBind(RightMoveButton, 'D')
buttonActionBind(TopMoveButton, 'W')
buttonActionBind(BottomMoveButton, 'S')

DropButton.addEventListener("click", () => {
	EventEmitter.emit(EMITTER_DROP_OP)
})
BoomButton.addEventListener("click", () => {
	EventEmitter.emit(EMITTER_BOOM_OP)
})
StopButton.addEventListener("click", stopGame)

let CANVAS_WIDTH = Math.min(document.documentElement.offsetWidth, 800)
let CANVAS_HEIGHT = (CANVAS_WIDTH * 13) / 33
const UNIT = CANVAS_WIDTH / 33
// 单步移动
const MOVE_UNIT = UNIT / 100

const Stage = new Konva.Stage({
	container: "container-main",
	width: CANVAS_WIDTH,
	height: CANVAS_HEIGHT,
})

const Layer = new Konva.Layer()
const MonsterLayer = new Konva.Layer()
const BoomLayer = new Konva.Layer() 
const PromptLayer = new Konva.Layer()
const PersonLayer = new Konva.Layer()

Stage.add(Layer)
Stage.add(MonsterLayer)
Stage.add(BoomLayer)
Stage.add(PromptLayer)
Stage.add(PersonLayer)

PromptLayer.zIndex(4)
PersonLayer.zIndex(3)
MonsterLayer.zIndex(2)
BoomLayer.zIndex(1)

let idCounter = 0
// 游戏状态
let isStart = true
let startPrompt

// 销毁
const EMITTER_DESTROY = "EMITTER_DESTROY"
// 游戏结束
const EMITTER_GAME_OVER = "EMITTER_GAME_OVER"
// 墙被摧毁
const EMITTER_WALL_DESTROY = "EMITTER_WALL_DESTROY"
// 怪物创建
const EMITTER_MONSTER_CREATE = "EMITTER_MONSTER_CREATE"
// 怪物移动
const EMITTER_MONSTER_MOVE = "EMITTER_MONSTER_MOVE"
// 人物移动
const EMITTER_PERSON_MOVE = "EMITTER_PERSON_MOVE"
// 左移动操作
const EMITTER_LEFT_OP = "EMITTER_LEFT_OP"
// 右移动操作
const EMITTER_RIGHT_OP = "EMITTER_RIGHT_OP"
// 上移动操作
const EMITTER_TOP_OP = "EMITTER_TOP_OP"
// 下移动操作
const EMITTER_BOTTOM_OP = "EMITTER_BOTTOM_OP"
// 炸弹爆炸
const EMITTER_BOOM_BOOMING = "EMITTER_BOOM_BOOMING"
// 放炸弹操作
const EMITTER_DROP_OP = "EMITTER_DROP_OP"
// 释放炸弹操作
const EMITTER_BOOM_OP = "EMITTER_BOOM_OP"
// 开始暂停操作
const EMITTER_START_OP = "EMITTER_START_OP"
// 进入下一关操作
const EMITTER_NEXT_OP = "EMITTER_NEXT_OP"
// 全局动画
const EMITTER_TIMER = "EMITTER_TIMER"
const EventEmitter = new EventEmitter3()

const createKeyboardAnimation = CreateKeyboardAnimation()

// Object

class CoreObject {
	// 在这里监听unit改变

	constructor(position) {
		this.id = idCounter++
		this.x = position[0]
		this.y = position[1]
		this.eventBind = this.eventBind.bind(this)
		this.eventUnBind = this.eventUnBind.bind(this)
		this.destroy = this.destroy.bind(this)
	}

	x = 0
	y = 0
	instance
	loading = false
	disabled = false
	id

	create() {}

	actionWrapper(action) {
		const that = this
		return function (...args) {
			if (that.disabled) return
			action.call(that, ...args)
		}
	}

	eventBind() {
		EventEmitter.once(EMITTER_DESTROY, this.destroy)
		EventEmitter.addListener(EMITTER_START_OP, this.onStart, this)
	}

	eventUnBind() {
		EventEmitter.removeListener(EMITTER_START_OP, this.onStart, this)
	}

	updatePosition(position) {
		if (position) {
			this.x = position.x
			this.y = position.y
		}
		this.instance &&
			this.instance.absolutePosition({ x: this.x * UNIT, y: this.y * UNIT })
	}

	destroy() {
		this.instance && this.instance.destroy()
		this.eventUnBind()
	}

	onStart() {
		isStart ? this.start() : this.stop()
	}

	stop() {
		this.disabled = true
	}

	start() {
		this.disabled = false
	}
}

class AnimationObject extends CoreObject {

	constructor(position) {
		super(position)
	}

	normalImage 
	dieImage 
	destroyingImage = []
	moveImage 

	lifeCycle = 1

	moveIndex = 0 

	get isAlive() {
		return this.lifeCycle === 1
	}

	// 创建
	create(afterCrate) {
		loader(this.normalImage, image => {
			this.instance = new Konva.Image({
				x: this.x * UNIT,
				y: this.y * UNIT,
				width: UNIT,
				height: UNIT,
				image,
			})
			afterCrate && afterCrate()
			this.loading = false 
		})
	}

	// 全局循环
	loop() {
		if(this.isAlive) {
			this.moveAnimation()
		}else if(this.lifeCycle >= 2 && this.lifeCycle < 100) {
			this.dieAnimation()
		}else if(this.lifeCycle >= 100) {
			this.destroyAnimation()
		}
		return !this.isAlive
	}

	over() {
		this.lifeCycle = 2
	}

	// 运动动画
	moveAnimation() {
		const move = this.moveImage 
		if(Array.isArray(move) && move.length) {
			const length = move.length
			if((length - 1) < this.moveIndex) {
				this.moveIndex = 0 
			}
			loader(move[this.moveIndex], image => {
				this.instance.image(image)
			})
			this.moveIndex ++
			this.moveIndex %= length
		}
	}

	// 死亡动画
	dieAnimation() {
		if(!this.dieImage) {
			this.lifeCycle = 100 
			return 
		}
		if(this.lifeCycle === 2) {
			loader(this.dieImage, (image) => {
				this.instance.image(image)
			})
		}
		this.lifeCycle ++
	}

	// 消失动画
	destroyAnimation() {
		const destroy = this.destroyingImage 
		const destroyImageLength = destroy.length
		if(this.lifeCycle > 120 + 20 * destroyImageLength) {
			return this.destroy()
		}
		const index = (this.lifeCycle - 100) / 20 
		const targetImage = destroy[index]
		if(targetImage) {
			loader(targetImage, (image) => {
				this.instance.image(image)
			})
		}
		this.lifeCycle ++
	}

}

// 角色
class Person extends AnimationObject {
	constructor(position, life) {
		super(position)
		this.create()
		this.life = life
		this.move = this.actionWrapper(this.move)
		this.dropBoom = this.actionWrapper(this.dropBoom)
		this.eventBind()
	}

	type = "PERSON"

	normalImage = PERSON_RIGHT_MOVE_1

	// buff
	boom = new BoomFactory()
	life = 3

	create() {
		super.create(() => {
			PersonLayer.add(this.instance)
			EventEmitter.emit(
				EMITTER_PERSON_MOVE,
				this,
				{ x: this.x, y: this.y },
				() => {}
			)
		})
	}

	die() {
		this.over()
		this.life--
		EventEmitter.emit(EMITTER_GAME_OVER, this.life)
	}

	revisePosition(position, delta) {
		const { x, y } = position 
		const newPosition = {
			...position
		}
		const { deltaX, deltaY } = delta 
		const roundX = Math.round(x)
		const roundY = Math.round(y)
		let newX = Math.abs(roundX - x) <= 0.3 ? roundX : x
		let newY = Math.abs(roundY - y) <= 0.3 ? roundY : y
		if(!!deltaX) {
			newPosition.y = newY
		}else if(!!deltaY) {
			newPosition.x = newX
		}
		return newPosition
	}

	getMoveImage(delta) {
		const { deltaX, deltaY } = delta
		if(!!deltaX) return deltaX > 0 ? [PERSON_RIGHT_MOVE_1, PERSON_RIGHT_MOVE_2, PERSON_RIGHT_MOVE_3, PERSON_RIGHT_MOVE_4, PERSON_RIGHT_MOVE_5] : [PERSON_LEFT_MOVE_1, PERSON_LEFT_MOVE_2, PERSON_LEFT_MOVE_3, PERSON_LEFT_MOVE_4, PERSON_LEFT_MOVE_5]
		return deltaY > 0 ? [ PERSON_BOTTOM_MOVE_1, PERSON_BOTTOM_MOVE_2, PERSON_BOTTOM_MOVE_3, PERSON_BOTTOM_MOVE_4 ] : [ PERSON_TOP_MOVE_1, PERSON_TOP_MOVE_2, PERSON_TOP_MOVE_3, PERSON_TOP_MOVE_4 ]
	}

	move(delta) {
		if (this.loading || this.loop()) return
		this.loading = true
		const { deltaX, deltaY } = delta
		this.moveImage = this.getMoveImage(delta)
		this.loop()
		let newX = this.x + (deltaX * MOVE_UNIT * 20) / UNIT
		let newY = this.y + (deltaY * MOVE_UNIT * 20) / UNIT
		newX = toFixed4(newX)
		newY = toFixed4(newY)
		const newPosition = this.revisePosition({
			x: newX,
			y: newY,
		}, delta)
		// 碰到障碍墙
		if (knockWall(newPosition)) {
			console.log("person knocked wall")
			this.loading = false 
			return
		}
		let counter = EventEmitter.listenerCount(EMITTER_PERSON_MOVE)
		if (counter === 0) {
			this.updatePosition(newPosition)
			this.loading = false
			return
		}
		let knocked = false
		let knockType
		EventEmitter.emit(
			EMITTER_PERSON_MOVE,
			this,
			newPosition,
			(type, isKnock) => {
				counter--
				if (isKnock) {
					knocked = true
					knockType = type
				}
				if (counter === 0) {
					if (knocked && knockType !== "BUFF") {
						switch (knockType) {
							case "MONSTER":
							case "FIRE":
								this.die()
								break
							default:
								console.log("hello world")
						}
					} else {
						this.updatePosition(newPosition)
					}
					this.loading = false
				}
			}
		)
	}

	dropBoom() {
		const position = {
			x: this.x,
			y: this.y,
		}
		this.boom.create(position)
	}

	boomedBoom() {
		this.boom.boom()
	}

	onTargetMove(instance, position, onKnock) {
		const isKnock = knockJudge({ x: this.x, y: this.y }, { ...position })
		if (isKnock) {
			this.die()
		}
		onKnock(this.type, isKnock)
	}

	eventBind() {
		super.eventBind()
		EventEmitter.addListener(EMITTER_LEFT_OP, this.move, this)
		EventEmitter.addListener(EMITTER_RIGHT_OP, this.move, this)
		EventEmitter.addListener(EMITTER_TOP_OP, this.move, this)
		EventEmitter.addListener(EMITTER_BOTTOM_OP, this.move, this)

		EventEmitter.addListener(EMITTER_DROP_OP, this.dropBoom, this)
		EventEmitter.addListener(EMITTER_BOOM_OP, this.boomedBoom, this)

		EventEmitter.addListener(EMITTER_MONSTER_MOVE, this.onTargetMove, this)

		EventEmitter.addListener(EMITTER_BOOM_BOOMING, this.onTargetMove, this)
	}

	eventUnBind() {
		super.eventBind()
		EventEmitter.removeListener(EMITTER_LEFT_OP, this.move, this)
		EventEmitter.removeListener(EMITTER_RIGHT_OP, this.move, this)
		EventEmitter.removeListener(EMITTER_TOP_OP, this.move, this)
		EventEmitter.removeListener(EMITTER_BOTTOM_OP, this.move, this)

		EventEmitter.removeListener(EMITTER_DROP_OP, this.dropBoom, this)
		EventEmitter.removeListener(EMITTER_BOOM_OP, this.boomedBoom, this)

		EventEmitter.removeListener(EMITTER_MONSTER_MOVE, this.onTargetMove, this)

		EventEmitter.removeListener(EMITTER_BOOM_BOOMING, this.onTargetMove, this)
	}
}

// 火🔥
class Fire extends CoreObject {
	constructor(position, options) {
		super(position)
		const { maxBoomArea, align } = options
		this.maxBoomArea = maxBoomArea
		this.align = align
		this.create()
		this.eventBind()
	}

	type = "FIRE"

	align = 'vertical'
	maxBoomArea = 2 
	boomStart = 0
	boomEnd = 0
	boomAnimation = 0 
	boomUpdated = false 

	nextEventBindEnd = false 

	emitBooming({ x, y }, callback) {
		let counter = EventEmitter.listenerCount(EMITTER_BOOM_BOOMING)
		let knockType
		let knocked = false
		EventEmitter.emit(EMITTER_BOOM_BOOMING, this, { x, y }, (type, isKnock) => {
			counter--
			if (isKnock) {
				knockType = type
				knocked = true
			}
			if (counter === 0) {
				callback(knocked && (['WALL', 'DOOR'].includes(knockType)))
			}
		})
	}

	create() {
		this.instance = new Konva.Image({
			x: this.x * UNIT,
			y: this.y * UNIT,
			width: UNIT,
			height: UNIT,
			fill: this.align === "vertical" ? "yellow" : "black",
		})
		BoomLayer.add(this.instance)
	}

	get updatePosition() {
		return this.align === 'vertical' ? 'y' : 'x'
	}

	get updateSize() {
		return this.align === 'vertical' ? 'height' : 'width'
	}

	animation() {
		// destroy
		this.loading = this.boomStart >= this.maxBoomArea && this.boomEnd >= this.maxBoomArea
		if(this.loading) {
			if(!this.nextEventBindEnd) {
				this.nextEventBindEnd = true 
				this.nextEventBind()
			}
			return 
		} 
		this.boomAnimation++
		this.boomAnimation %= 5
		if (this.boomAnimation !== 0 && !this.boomUpdated) return
		this.boomCounter = false 
		// update
		if (
			this.boomStart < this.maxBoomArea ||
			this.boomEnd < this.maxBoomArea
		) {
			let newPosition = getInfo(this.instance)
			new Promise((resolve) => {
				if (this.boomStart < this.maxBoomArea) {
					const templatePosition = {
						...newPosition,
						[this.updatePosition]: newPosition[this.updatePosition] - UNIT,
						[this.updateSize]: newPosition[this.updateSize] + UNIT,
					}
					const x = Math.round(templatePosition.x / UNIT)
					const y = Math.round(templatePosition.y / UNIT)
					if(knockWall({ x, y })) this.boomStart = this.maxBoomArea
					if (this.boomStart < this.maxBoomArea) {
						this.emitBooming({ x, y }, (isKnock) => {
							if (isKnock) {
								this.boomStart = this.maxBoomArea
							}else {
								this.boomStart ++
								newPosition = {
									...newPosition,
									...templatePosition,
								}
							}
							resolve()
						})
					}else {
						this.boomStart ++
						resolve() 
					}
				} else {
					resolve()
				}
			})
			.then(() => {
				return new Promise((resolve) => {
					if (this.boomEnd < this.maxBoomArea) {
						const templatePosition = {
							...newPosition,
							[this.updateSize]: newPosition[this.updateSize] + UNIT,
						}
						const x = Math.round(templatePosition.x / UNIT)
						const y = Math.round(templatePosition.y / UNIT)
						const size = Math.round(templatePosition[this.updateSize] / UNIT)
						const knockTarget = this.align === 'vertical' ? { x, y: y + size - 1 } : { x: x + size - 1, y }
						if(knockWall(knockTarget)) this.boomEnd = this.maxBoomArea
						if (this.boomEnd < this.maxBoomArea) {
							this.emitBooming(knockTarget, (isKnock) => {
								if (isKnock) {
									this.boomEnd = this.maxBoomArea
								}else {
									this.boomEnd ++
									newPosition = {
										...newPosition,
										...templatePosition,
									}
								}
								resolve()
							})
						}else {
							this.boomEnd ++
							resolve() 
						}
					} else {
						resolve()
					}
				})
			})
			.then(() => {
				this.boomUpdated = true 
				this.instance[this.updatePosition](newPosition[this.updatePosition])
				this.instance[this.updateSize](newPosition[this.updateSize])
			})
		} else {
			this.boomUpdated = true 
		}
	}

	onTargetMove(instance, position, onKnock) {
		const isKnock = knockJudge(formatInfo(getInfo(this.instance)), position)
		onKnock(this.type, isKnock)
	}

	eventBind = () => {
		super.eventBind()
		EventEmitter.addListener(EMITTER_TIMER, this.animation, this)
	}

	eventUnBind = () => {
		super.eventBind()
		EventEmitter.removeListener(EMITTER_TIMER, this.animation, this)
		EventEmitter.removeListener(EMITTER_PERSON_MOVE, this.onTargetMove, this)
		EventEmitter.removeListener(EMITTER_MONSTER_MOVE, this.onTargetMove, this)
	}

	nextEventBind = () => {
		EventEmitter.addListener(EMITTER_PERSON_MOVE, this.onTargetMove, this)
		EventEmitter.addListener(EMITTER_MONSTER_MOVE, this.onTargetMove, this)
	}

}

// 炸弹
class Boom extends CoreObject {
	constructor(position, options) {
		super(position)
		const { onBoom, multipleState, timeState, hugeState } = options
		this.onBoom = onBoom
		this.multipleState = multipleState
		this.timeState = timeState
		this.hugeState = hugeState
		this.create()
		this.eventBind()
	}

	type = "BOOM"

	multipleState = false
	timeState = false
	hugeState = false

	onBoom
	// loading timeing wait boom destroy
	timeStep = -1
	timeoutStart
	timeoutRest = 2000

	initBoomInstance
	boomVertical
	boomHorizontal

	boomAnimation = 0

	get maxBoomArea() {
		return this.hugeState ? 3 : 1
	}

	get isBoomed() {
		return this.timeStep > 4
	}

	onTargetMove = (instance, position, onKnock) => {
		const isKnock = knockJudge(position, { x: this.x, y: this.y })
		const prevKnock = knockJudge({ x: instance.x, y: instance.y }, { x: this.x, y: this.y })
		onKnock(this.type, isKnock && !prevKnock)
	}

	eventBind = () => {
		super.eventBind()
		EventEmitter.addListener(EMITTER_PERSON_MOVE, this.onTargetMove, this)
		EventEmitter.addListener(EMITTER_MONSTER_MOVE, this.onTargetMove, this)
		EventEmitter.addListener(EMITTER_TIMER, this.animation, this)
	}

	eventUnBind = () => {
		super.eventBind()
		EventEmitter.removeListener(EMITTER_PERSON_MOVE, this.onTargetMove, this)
		EventEmitter.removeListener(EMITTER_MONSTER_MOVE, this.onTargetMove, this)
		EventEmitter.removeListener(EMITTER_TIMER, this.animation, this)
	}

	create() {
		loader(BOOM, (image) => {
			this.initBoomInstance = new Konva.Image({
				x: this.x * UNIT,
				y: this.y * UNIT,
				width: UNIT,
				height: UNIT,
				image,
			})
			this.timeStep = 0
			Layer.add(this.initBoomInstance)
			this.timeoutStart = Date.now()
			if (this.timeState) {
				this.timeStep = 1
			}
		})
	}

	animation() {
		if (this.timeStep === 0) {
			const now = Date.now()
			this.timeoutRest -= now - this.timeoutStart
			this.timeoutStart = now
			if (this.timeoutRest <= 0) this.timeStep += 2
		} else if (this.timeStep >= 2) {
			this.immediateBoom()
		}
	}

	// 立刻爆炸
	immediateBoom(step) {
		if(step !== undefined) this.timeStep = 2
		// init
		if (!this.boomVertical) {
			this.type = 'FIRE'
			EventEmitter.emit(EMITTER_BOOM_BOOMING, this, { x: this.x, y: this.y }, () => {
				this.type = 'BOOM'
			})
			this.initBoomInstance.destroy()
			this.boomVertical = new Fire([this.x, this.y], {
				align: 'vertical',
				maxBoomArea: this.maxBoomArea
			})
			this.boomHorizontal = new Fire([this.x, this.y], {
				align: 'horizontal',
				maxBoomArea: this.maxBoomArea
			})
			return
		}
		// destroy
		if (
			this.boomVertical.loading && this.boomHorizontal.loading
		) {
			this.timeStep++
			if (this.timeStep > 50) {
				this.onBoom(this.id)
				this.destroy()
			}
		}
	}

	destroy() {
		super.destroy()
		try {
			this.initBoomInstance.destroy()
			this.boomVertical.destroy()
			this.boomHorizontal.destroy()
			this.boomVertical = undefined
			this.boomHorizontal = undefined
		} catch (err) {}
	}
}

class BoomFactory {
	multipleState = false
	timeState = false
	hugeState = false

	boomMap = {}

	onBoom = (id) => {
		this.boomMap[id] = undefined
		delete this.boomMap[id]
	}

	create(position) {
		const multipleState = GOD || this.multipleState
		if (Object.keys(this.boomMap).length >= (multipleState ? 5 : 1)) return
		const { x, y } = position
		const boom = new Boom([Math.round(x), Math.round(y)], {
			onBoom: this.onBoom,
			multipleState,
			timeState: GOD || this.timeState,
			hugeState: GOD || this.hugeState,
		})
		this.boomMap[boom.id] = boom
	}

	boom() {
		if(!GOD && !this.timeState) return 
		const targetId = Math.min(...Object.entries(this.boomMap).filter(item => !item[1].isBoomed).map(item => item[0]))
		!!this.boomMap[targetId] && this.boomMap[targetId].immediateBoom(2)
	}
}

class Buff extends AnimationObject {
	display = false

	constructor(position) {
		super(position)
		this.eventBind()
	}

	type = "BUFF"

	create() {
		super.create(() => {
			Layer.add(this.instance)
		})
	}

	onTargetMove(instance, position, onKnock) {
		const isKnock = knockJudge(position, { x: this.x, y: this.y })
		onKnock(this.type, isKnock)
		if (isKnock) {
			this.destroy()
		}
	}

	onWallDestroy(position) {
		if (position.x === this.x && position.y === this.y) {
			this.create()
			this.nextEventBind()
		}
	}

	nextEventBind() {
		EventEmitter.addListener(EMITTER_PERSON_MOVE, this.onTargetMove, this)
	}

	eventBind = () => {
		super.eventBind()
		EventEmitter.addListener(EMITTER_WALL_DESTROY, this.onWallDestroy, this)
	}

	eventUnBind = () => {
		super.eventBind()
		EventEmitter.removeListener(EMITTER_WALL_DESTROY, this.onWallDestroy, this)
		EventEmitter.removeListener(EMITTER_PERSON_MOVE, this.onTargetMove, this)
	}
}

// 连放炸弹buff
class LoopBuff extends Buff {

	normalImage = LOOP_BOOM_BUFF

	onTargetMove(instance, position, onKnock) {
		super.onTargetMove(instance, position, (type, isKnock) => {
			onKnock(type, isKnock)
			if (isKnock) instance.boom.multipleState = true
		})
	}
}

// 炸弹定点爆炸buff
class TimeBoomBuff extends Buff {
	normalImage = TIME_BOOM_BUFF
	onTargetMove(instance, position, onKnock) {
		super.onTargetMove(instance, position, (type, isKnock) => {
			onKnock(type, isKnock)
			if (isKnock) instance.boom.timeState = true
		})
	}
}

// 炸弹爆炸范围buff
class SuperBoomBuff extends Buff {
	normalImage = SUPER_BOOM_BUFF
	onTargetMove(instance, position, onKnock) {
		super.onTargetMove(instance, position, (type, isKnock) => {
			onKnock(type, isKnock)
			if (isKnock) instance.boom.hugeState = true
		})
	}
}

class Door extends Buff {

	type = "DOOR"
	normalImage = DOOR

	onTargetMove(instance, position, onKnock) {
		if (EventEmitter.listenerCount(EMITTER_MONSTER_CREATE) !== 0 && instance.type !== 'FIRE') {
			return onKnock(this.type, false)
		}
		const type = instance.type 
		const isKnock = knockJudge(position, { x: this.x, y: this.y })
		onKnock(this.type, isKnock)
		if (isKnock) {
			if(type === 'PERSON') EventEmitter.emit(EMITTER_NEXT_OP)
			if(type === 'FIRE') {
				setTimeout(() => {
					new Array(5).fill(0).forEach(() => {
						new (randomMonster())([this.x, this.y])
					})
				}, 3000)
			}
		}
	}

	nextEventBind() {
		super.nextEventBind()
		EventEmitter.addListener(EMITTER_BOOM_BOOMING, this.onTargetMove, this)
	}

	eventUnBind() {
		super.eventBind()
		EventEmitter.removeListener(EMITTER_BOOM_BOOMING, this.onTargetMove, this)
	}

}

class Wall extends AnimationObject {
	constructor(position, destructible) {
		super(position)
		this.destructible = destructible
		this.loading = this.destructible
		this.normalImage = this.destructible ? DESTRUCTIBLE_WALL : UN_DESTRUCTIBLE_WALL
		this.create()
		this.destructible && this.eventBind()
	}

	// 是否可以被破坏
	destructible = false
	// 位置
	position = []
	type = "WALL"

	loading = true 

	destroyingImage = [
		WALL_DESTROY_1,
		WALL_DESTROY_2
	]

	create() {
		super.create(() => {
			Layer.add(this.instance)
		})
	}

	onTargetMove(instance, position, onKnock) {
		if(this.loading || !this.isAlive) return onKnock(this.type, false)
		const isKnock = knockJudge({ x: this.x, y: this.y }, { ...position })
		onKnock(this.type, isKnock)
		if(isKnock && instance.type === 'FIRE') {
			this.nextEventBind()
			this.over()
		}
	}

	nextEventBind() {
		EventEmitter.addListener(EMITTER_TIMER, this.loop, this)
	}

	eventBind() {
		super.eventBind()
		EventEmitter.addListener(EMITTER_PERSON_MOVE, this.onTargetMove, this)
		EventEmitter.addListener(EMITTER_MONSTER_MOVE, this.onTargetMove, this)
		EventEmitter.addListener(EMITTER_BOOM_BOOMING, this.onTargetMove, this)
	}

	eventUnBind() {
		super.eventUnBind()
		EventEmitter.removeListener(EMITTER_PERSON_MOVE, this.onTargetMove, this)
		EventEmitter.removeListener(EMITTER_MONSTER_MOVE, this.onTargetMove, this)
		EventEmitter.removeListener(EMITTER_BOOM_BOOMING, this.onTargetMove, this)
		EventEmitter.removeListener(EMITTER_TIMER, this.loop, this)
	}

	destroy() {
		super.destroy() 
		EventEmitter.emit(EMITTER_WALL_DESTROY, { x: this.x, y: this.y })
	}

}

class Monster extends AnimationObject {
	constructor(position) {
		super(position)
		this.init() 
		this.create()
		this.eventBind()
	}

	destroyingImage = [
		MONSTER_DESTROYING_1,
		MONSTER_DESTROYING_2,
		MONSTER_DESTROYING_3,
		MONSTER_DESTROYING_4
	]

	type = "MONSTER"

	// 移动速度
	speed = 1
	// 可穿越
	crossable = false

	// 运动方向
	direction
	// 运动距离
	moveCounter = 0

	loading = true 

	init() {}

	create() {
		super.create(() => {
			MonsterLayer.add(this.instance)
		})
	}

	move = () => {
		if (this.loading || this.loop()) return
		this.loading = true
		if (this.moveCounter === 0) {
			// left top right bottom
			const directions = [
				[-1, 0],
				[0, -1],
				[1, 0],
				[0, 1],
			]
			const moveCounters = [1, 3, 5, 7, 9]
			this.direction = directions[Math.floor(Math.random() * directions.length)]
			this.moveCounter =
				moveCounters[Math.floor(Math.random() * moveCounters.length)] * 100
		}
		this.moveCounter--
		const [deltaX, deltaY] = this.direction
		const newX = this.x + (deltaX * MOVE_UNIT * this.speed) / UNIT
		const newY = this.y + (deltaY * MOVE_UNIT * this.speed) / UNIT
		const newPosition = {
			x: toFixed4(newX),
			y: toFixed4(newY),
		}
		// 碰到障碍墙
		if (knockWall(newPosition)) {
			this.moveCounter = 0
			this.loading = false
			console.log("monster knock the undestructible wall")
			return
		}
		let counter = EventEmitter.listenerCount(EMITTER_MONSTER_MOVE)
		if (counter === 0) {
			this.updatePosition(newPosition)
			this.loading = false
			return
		}
		let knocked = false
		let knockType
		EventEmitter.emit(
			EMITTER_MONSTER_MOVE,
			this,
			newPosition,
			(type, isKnock) => {
				counter--
				if (isKnock) {
					if (!this.crossable || type !== "WALL") {
						knocked = true
						knockType = type
					}
				}
				if (counter === 0) {
					if (knocked) {
						console.log("monster knocked", knockType)
						if(knockType === 'FIRE') {
							// 死亡
							this.over()
						}
						this.moveCounter = 0
					} else {
						this.updatePosition(newPosition)
					}
					this.loading = false
				}
			}
		)
	}

	onTargetMove(instance, position, onKnock) {
		if(this.loading || !this.isAlive) return onKnock(this.type, false)
		const isKnock = knockJudge(position, { x: this.x, y: this.y })
		onKnock(this.type, isKnock)
		if (instance.type === "FIRE" && isKnock) {
			this.over()
		}
	}

	createMonster() {
		/** Prefix */
	}

	eventBind() {
		super.eventBind()
		EventEmitter.addListener(EMITTER_PERSON_MOVE, this.onTargetMove, this)
		EventEmitter.addListener(EMITTER_BOOM_BOOMING, this.onTargetMove, this)
		EventEmitter.addListener(EMITTER_MONSTER_CREATE, this.createMonster, this)
		EventEmitter.addListener(EMITTER_TIMER, this.move, this)
	}

	eventUnBind() {
		super.eventUnBind()
		EventEmitter.removeListener(EMITTER_PERSON_MOVE, this.onTargetMove, this)
		EventEmitter.removeListener(EMITTER_BOOM_BOOMING, this.onTargetMove, this)
		EventEmitter.removeListener(
			EMITTER_MONSTER_CREATE,
			this.createMonster,
			this
		)
		EventEmitter.removeListener(EMITTER_TIMER, this.move, this)
	}

}

// 气球怪
class BalloonMonster extends Monster {

	init() {
		this.normalImage = BALLOON_MONSTER
		this.dieImage = BALLOON_MONSTER_DIE
	}

	animation() {
		const scaleY = this.instance.scaleY() || 1
		this.instance.scaleY(scaleY == 1 ? 0.8 : 1)
	}
}

// 穿墙怪
class CrossWallMonster extends Monster {
	crossable = true

	init() {
		this.normalImage = CROSS_MONSTER
		this.dieImage = CROSS_MONSTER_DIE
	}

	animation() {
		const scaleX = this.instance.scaleX() || 1
		this.instance.scaleX(scaleX == 1 ? 0.8 : 1)
	}
}

// 高速怪
class SpeedMonster extends Monster {
	speed = this.speed * 3

	init() {
		this.normalImage = SPEED_MONSTER
		this.dieImage = SPEED_MONSTER_DIE
	}

	animation() {
		const scaleX = this.instance.scaleX() || 1
		this.instance.scaleX(scaleX == 1 ? 0.8 : 1)
	}
}

function createGamePrompt({ content, onRestart, timeout }) {
	const group = new Konva.Group({
		width: CANVAS_WIDTH,
		height: CANVAS_HEIGHT,
		x: 0,
		y: 0,
	})
	group.add(
		new Konva.Rect({
			width: CANVAS_WIDTH,
			height: CANVAS_HEIGHT,
			x: 0,
			y: 0,
			fill: "rgba(0, 0, 0, 0.9)",
		})
	)
	PromptLayer.add(group)
	const commonFontConfig = {
		align: "center",
		verticalAlign: "center",
		fontSize: CANVAS_WIDTH / 50,
		x: Stage.width() / 2,
		y: Stage.height() / 2,
		fill: "#fff",
	}
	const text = new Konva.Text({
		...commonFontConfig,
		text: content,
	})
	text.offsetX(text.width() / 2)
	text.offsetY(text.height() / 2)

	if (!~timeout) {
		text.on("click", () => {
			group.destroy()
			onRestart()
		})
	}

	group.add(text)
	if (!!~timeout) {
		setTimeout(() => {
			group.destroy()
			onRestart()
		}, timeout)
	}
	return group.destroy.bind(group)
}

class Game {
	constructor() {
		this.init()
		this.eventBind()
	}

	animationTimer
	timer
	timeout = 480

	level = 1
	personLife = 3

	loading = false

	get levelData() {
		return LEVEL_MAP[this.level - 1]
	}

	init() {
		const { wall, destructibleWall, monster, time, buff } = this.levelData
		this.timeout = time
		wall.forEach(this.createWall.bind(this, false))
		destructibleWall.forEach(this.createWall.bind(this, true))
		monster.forEach(this.createMonster)
		buff.forEach(this.createBuff)
		this.initDoor()
		this.initPerson()
		this.initlevel()
		this.start()
	}

	initlevel() {
		LevelContent.innerHTML = this.level
	}

	// 创建障碍墙
	createWall(destructible, position) {
		new Wall(position, destructible)
	}

	// 创建怪物
	createMonster([type, ...position]) {
		new (getMonster(type))(position)
	}

	// 创建buff
	createBuff([type, ...position]) {
		new (getBuff(type))(position)
	}

	// 创建门
	initDoor() {
		const { door } = this.levelData
		new Door(door)
	}

	// 创建角色
	initPerson() {
		new Person([1, 2], this.personLife)
	}

	onGameOver(life) {
		if (this.loading) return
		this.loading = true
		this.personLife = typeof life === "number" ? life : this.personLife - 1
		this.destroy()
		if (this.personLife !== 0) {
			createGamePrompt({
				content: `你已阵亡！（还剩${this.personLife}次机会）`,
				onRestart: this.restart.bind(this),
				timeout: 3000,
			})
		} else {
			createGamePrompt({
				content: `你已阵亡！点我继续(*^▽^*)`,
				onRestart: () => {
					this.personLife = 3
					this.restart()
				},
				timeout: -1,
			})
		}
	}

	onNext() {
		this.loading = true 
		this.destroy()
		if (this.level === LEVEL_MAP.length) {
			createGamePrompt({
				content: "恭喜通关！！！点我重玩(*^▽^*)",
				onRestart: () => {
					this.level = 1
					this.personLife = 3
					this.restart()
				},
				timeout: -1,
			})
		} else {
			this.level++
			createGamePrompt({
				content: `恭喜通过本关！！即将进入下一关`,
				onRestart: this.restart.bind(this),
				timeout: 3000,
			})
		}
	}

	onStart() {
		isStart ? this.start() : this.stop()
	}

	eventBind() {
		EventEmitter.addListener(EMITTER_GAME_OVER, this.onGameOver, this)
		EventEmitter.addListener(EMITTER_NEXT_OP, this.onNext, this)
		EventEmitter.addListener(EMITTER_START_OP, this.onStart, this)
	}

	eventUnBind() {
		EventEmitter.removeListener(EMITTER_GAME_OVER, this.onGameOver, this)
		EventEmitter.removeListener(EMITTER_NEXT_OP, this.onNext, this)
		EventEmitter.removeListener(EMITTER_START_OP, this.onStart, this)
	}

	start() {
		TimeContent.innerHTML = this.timeout
		this.timer = setInterval(() => {
			this.timeout--
			TimeContent.innerHTML = this.timeout
			if (this.timeout === 0) {
				this.stop()
				this.onGameOver()
			}
		}, 1000)
		this.animationTimer = setInterval(() => {
			EventEmitter.emit(EMITTER_TIMER)
			createKeyboardAnimation.animation()
		}, 1000 / 60)
	}

	stop() {
		clearInterval(this.timer)
		clearInterval(this.animationTimer)
	}

	destroy() {
		this.stop()
		this.loading = false
		this.timeout = 480
		EventEmitter.emit(EMITTER_DESTROY)
	}

	restart() {
		this.destroy()
		this.init()
	}
}

const game = new Game()
